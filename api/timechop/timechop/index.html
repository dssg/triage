
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Triage.">
      
      
      
        <link rel="canonical" href="http://dssg.github.io/triage/api/timechop/timechop/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.4.6">
    
    
      
        <title>Timechop - Triage Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../triage_docs.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#triage.component.timechop.timechop-attributes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Triage Documentation" class="md-header__button md-logo" aria-label="Triage Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 22a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-6v7L9.5 7.5 7 9V2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Triage Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Timechop
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="http://github.com/dssg/triage" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dssg/triage
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Triage Documentation" class="md-nav__button md-logo" aria-label="Triage Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 22a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-6v7L9.5 7.5 7 9V2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12Z"/></svg>

    </a>
    Triage Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="http://github.com/dssg/triage" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dssg/triage
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://colab.research.google.com/github/dssg/triage/blob/master/example/colab/colab_triage.ipynb" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Online Tutorial (Google Colab)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Get started with your own project
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Get started with your own project
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../triage_project_workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Suggested workflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Dirty Duck Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Dirty Duck Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/dirty_duckling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dirty duckling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Case studies
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Case studies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/problem_description/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Problem description
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/eis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Early Warning System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/inspections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resource prioritization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Triage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Triage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/triage_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A deeper look into triage
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Are you curious about the setup?
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Are you curious about the setup?
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/data_preparation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data preparation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/for_the_impatient/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick setup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Triage documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Triage documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Experiment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Experiment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/experiment-config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/feature-testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing Feature Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/running/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running an Experiment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4" >
        
          
          <label class="md-nav__link" for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Upgrading an Experiment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            Upgrading an Experiment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/upgrade-to-v8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v7 -> v8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/upgrade-to-v7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v6 -> v7
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/upgrade-to-v6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v5 -> v6
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/upgrade-to-v5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v3/v4 -> v5
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/temporal-validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Temporal Validation Deep Dive
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/cohort-labels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cohort and Label Deep Dive
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/prediction-ranking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prediction Ranking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Generation Recipe Book
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/algorithm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment Algorithm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiments/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment Architecture
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model selection
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Model selection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../audition/audition_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro to Audition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../audition/model_selection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model Selection Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../audition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Postmodeling
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Postmodeling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../postmodeling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Postmodeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../postmodeling/postmodeling-config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Postmodeling & Crosstabs Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/ml_governance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model governance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../predictlist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Predictlist
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../dirtyduck/aws_batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scaling up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../db/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database Provisioner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8_1" >
        
          
          <label class="md-nav__link" for="__nav_5_8_1" id="__nav_5_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Audition
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8_1">
            <span class="md-nav__icon md-icon"></span>
            Audition
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../audition/auditioner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Auditioner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../audition/audition-config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audition Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../audition/selection_rules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Selection Rules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../audition/database-dependencies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database Dependencies
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.logger" class="md-nav__link">
    logger
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop" class="md-nav__link">
    Timechop
  </a>
  
    <nav class="md-nav" aria-label="Timechop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.feature_end_time" class="md-nav__link">
    feature_end_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.feature_start_time" class="md-nav__link">
    feature_start_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.label_end_time" class="md-nav__link">
    label_end_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.label_start_time" class="md-nav__link">
    label_start_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.max_training_histories" class="md-nav__link">
    max_training_histories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.model_update_frequency" class="md-nav__link">
    model_update_frequency
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.test_as_of_date_frequencies" class="md-nav__link">
    test_as_of_date_frequencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.test_durations" class="md-nav__link">
    test_durations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.test_label_timespans" class="md-nav__link">
    test_label_timespans
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.training_as_of_date_frequencies" class="md-nav__link">
    training_as_of_date_frequencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.training_label_timespans" class="md-nav__link">
    training_label_timespans
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.__init__" class="md-nav__link">
    __init__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.calculate_as_of_times" class="md-nav__link">
    calculate_as_of_times
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.calculate_train_test_split_times" class="md-nav__link">
    calculate_train_test_split_times
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.chop_time" class="md-nav__link">
    chop_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.define_test_matrices" class="md-nav__link">
    define_test_matrices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.define_train_matrix" class="md-nav__link">
    define_train_matrix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop.Timechop.generate_matrix_definitions" class="md-nav__link">
    generate_matrix_definitions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#triage.component.timechop.timechop-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Timechop</h1>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">









  <div class="doc doc-children">





<h2 id="triage.component.timechop.timechop-attributes">Attributes<a href="#triage.component.timechop.timechop-attributes" class="headerlink" title="Permanent link">#</a></h2>

<div class="doc doc-object doc-attribute">



<h3 id="triage.component.timechop.timechop.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">verboselogs</span><span class="o">.</span><span class="n">VerboseLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.logger" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">

    </div>

</div>
<h2 id="triage.component.timechop.timechop-classes">Classes<a href="#triage.component.timechop.timechop-classes" class="headerlink" title="Permanent link">#</a></h2>

<div class="doc doc-object doc-class">



<h3 id="triage.component.timechop.timechop.Timechop" class="doc doc-heading">
            <code>Timechop</code>


<a href="#triage.component.timechop.timechop.Timechop" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">








              <details class="quote">
                <summary>Source code in <code>src/triage/component/timechop/timechop.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Timechop</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature_start_time</span><span class="p">,</span>
        <span class="n">feature_end_time</span><span class="p">,</span>
        <span class="n">label_start_time</span><span class="p">,</span>
        <span class="n">label_end_time</span><span class="p">,</span>
        <span class="n">model_update_frequency</span><span class="p">,</span>
        <span class="n">training_as_of_date_frequencies</span><span class="p">,</span>
        <span class="n">max_training_histories</span><span class="p">,</span>
        <span class="n">training_label_timespans</span><span class="p">,</span>
        <span class="n">test_as_of_date_frequencies</span><span class="p">,</span>
        <span class="n">test_durations</span><span class="p">,</span>
        <span class="n">test_label_timespans</span><span class="p">,</span>
    <span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Date strings should follow the format `YYYY-MM-DD`. Date intervals</span>
<span class="sd">        should be strings of the Postgres interval input format.</span>

<span class="sd">        This class is often used within the Triage experiment pipeline, and</span>
<span class="sd">        initialized using parameters from a Triage [experiment config](../../../experiments/experiment-config/#time-splitting)</span>

<span class="sd">        Arguments:</span>
<span class="sd">            feature_start_time (str): Earliest date included in any feature</span>
<span class="sd">            feature_end_time (str): Day after last feature date (all data</span>
<span class="sd">                included in features are before this date)</span>
<span class="sd">            label_start_time (str): Earliest date for which labels are available</span>
<span class="sd">            label_end_time (str): Day AFTER last label date (all dates in any</span>
<span class="sd">                model are before this date)</span>
<span class="sd">            model_update_frequency (str): how frequently to retrain models</span>
<span class="sd">            training_as_of_date_frequencies (str): time between rows for same</span>
<span class="sd">                entity in train matrix</span>
<span class="sd">            max_training_histories (str): Interval specifying how much history</span>
<span class="sd">                for each entity to train on</span>
<span class="sd">            training_label_timespans (str): how much time is included in a label</span>
<span class="sd">                in the train matrix</span>
<span class="sd">            test_as_of_date_frequencies (str): time between rows for same entity</span>
<span class="sd">                in test matrix</span>
<span class="sd">            test_durations (str): How long into the future to make predictions</span>
<span class="sd">                for each entity. Controls the length of time included in a test</span>
<span class="sd">                matrix</span>
<span class="sd">            test_label_timespans (str): How much time is included in a label</span>
<span class="sd">                in the test matrix.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_start_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span>
            <span class="n">feature_start_time</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_end_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span>
            <span class="n">feature_end_time</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_start_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_end_time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Feature start time after feature end time.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_start_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span>
            <span class="n">label_start_time</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span>
            <span class="n">label_end_time</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_start_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_end_time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Label start time after label end time.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_update_frequency</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span>
            <span class="n">model_update_frequency</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">training_as_of_date_frequencies</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span>
            <span class="n">training_as_of_date_frequencies</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">test_as_of_date_frequencies</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span>
            <span class="n">test_as_of_date_frequencies</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_training_histories</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">max_training_histories</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">test_durations</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">test_durations</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">training_label_timespans</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">training_label_timespans</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">test_label_timespans</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">test_label_timespans</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">chop_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Given the attributes of the object, define all train/test splits</span>
<span class="sd">        for all combinations of the temporal parameters.</span>

<span class="sd">        return:</span>
<span class="sd">            list: a list of dictionaries defining train/test splits</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matrix_set_definitions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># in our example, we just have one value for each of these: 6month, 6month, and 3month</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">training_label_timespan</span><span class="p">,</span>
            <span class="n">test_label_timespan</span><span class="p">,</span>
            <span class="n">test_duration</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">training_label_timespans</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_label_timespans</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_durations</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># calculating the train-test split times starts from the end and walks backwards</span>
            <span class="c1"># e.g., train_test_split_times for our example with a 1 year model_update_frequency</span>
            <span class="c1"># will be every Oct. 1 from 2012 to 2016 (see comments in the method for details</span>
            <span class="c1"># on the calculation):</span>
            <span class="c1"># train_test_split_times = [2012-10-01, 2013-10-01, 2014-10-01, 2015-10-01, 2016-10-01]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Calculating train/test split times for training prediction span </span><span class="si">{</span><span class="n">training_label_timespan</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;test prediction span </span><span class="si">{</span><span class="n">test_label_timespan</span><span class="si">}</span><span class="s2">, test span </span><span class="si">{</span><span class="n">test_duration</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">train_test_split_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_train_test_split_times</span><span class="p">(</span>
                <span class="n">training_label_timespan</span><span class="o">=</span><span class="n">convert_str_to_relativedelta</span><span class="p">(</span>
                    <span class="n">training_label_timespan</span>
                <span class="p">),</span>
                <span class="n">test_label_timespan</span><span class="o">=</span><span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">test_label_timespan</span><span class="p">),</span>
                <span class="n">test_duration</span><span class="o">=</span><span class="n">test_duration</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train/test split times: </span><span class="si">{</span><span class="n">train_test_split_times</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># handle each training_as_of_date_frequency and max_training_history separately</span>
            <span class="c1"># to create matrices for each train_test_split_time.</span>
            <span class="c1"># in our example, we only have one value for each: 1day and 2year</span>
            <span class="k">for</span> <span class="p">(</span>
                <span class="n">training_as_of_date_frequency</span><span class="p">,</span>
                <span class="n">max_training_history</span><span class="p">,</span>
            <span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">training_as_of_date_frequencies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_training_histories</span>
            <span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Generating matrix definitions for training_as_of_date_frequency </span><span class="si">{</span><span class="n">training_as_of_date_frequency</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;max_training_history </span><span class="si">{</span><span class="n">max_training_history</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">train_test_split_time</span> <span class="ow">in</span> <span class="n">train_test_split_times</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating matrix definitions for split </span><span class="si">{</span><span class="n">train_test_split_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">matrix_set_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">generate_matrix_definitions</span><span class="p">(</span>
                            <span class="n">train_test_split_time</span><span class="o">=</span><span class="n">train_test_split_time</span><span class="p">,</span>
                            <span class="n">training_as_of_date_frequency</span><span class="o">=</span><span class="n">training_as_of_date_frequency</span><span class="p">,</span>
                            <span class="n">max_training_history</span><span class="o">=</span><span class="n">max_training_history</span><span class="p">,</span>
                            <span class="n">test_duration</span><span class="o">=</span><span class="n">test_duration</span><span class="p">,</span>
                            <span class="n">training_label_timespan</span><span class="o">=</span><span class="n">training_label_timespan</span><span class="p">,</span>
                            <span class="n">test_label_timespan</span><span class="o">=</span><span class="n">test_label_timespan</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">matrix_set_definitions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_train_test_split_times</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">training_label_timespan</span><span class="p">,</span> <span class="n">test_label_timespan</span><span class="p">,</span> <span class="n">test_duration</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate the split times between train and test matrices. All</span>
<span class="sd">        label spans in train matrices will end at this time, and this will be</span>
<span class="sd">        the first as of time in the respective test matrix.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            training_label_timespan (dateutil.relativedelta.relativedelta): how much</span>
<span class="sd">                time is included in training labels</span>
<span class="sd">            test_label_timespan (dateutil.relativedelta.relativedelta): how much time is included in test labels</span>
<span class="sd">            test_duration (str): for how long after the end of a training matrix are</span>
<span class="sd">                test predictions made</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: all split times for the temporal parameters</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if there are no valid split times in the temporal</span>
<span class="sd">            config</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># we always want to be sure we&#39;re using the most recent data, so for the splits,</span>
        <span class="c1"># we start from the very end of time for which we have labels and walk backwards,</span>
        <span class="c1"># ensuring we leave enough of a buffer for the test_label_timespan to get a full</span>
        <span class="c1"># set of labels for our last testing as_of_date</span>
        <span class="c1">#</span>
        <span class="c1"># in our example, last_test_label_time = 2017-07-01 - 6month = 2017-01-01</span>
        <span class="n">last_test_label_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_end_time</span> <span class="o">-</span> <span class="n">test_label_timespan</span>

        <span class="c1"># final label must be able to have feature data associated with it</span>
        <span class="k">if</span> <span class="n">last_test_label_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_end_time</span><span class="p">:</span>
            <span class="n">last_test_label_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_end_time</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Final test label date cannot be after end of feature time.&quot;</span>
            <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final label as of date: </span><span class="si">{</span><span class="n">last_test_label_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># all split times have to allow at least one training label before them</span>
        <span class="c1"># e.g., earliest_possible_split_time = max(1995-01-01, 2012-01-01) + 6month = 2012-01-01</span>
        <span class="n">earliest_possible_split_time</span> <span class="o">=</span> <span class="n">training_label_timespan</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_start_time</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Earliest possible train/test split time: </span><span class="si">{</span><span class="n">earliest_possible_split_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># last split is the first as of time in the final test matrix</span>
        <span class="c1"># that is, starting from the label_end_time, we&#39;ve walked back by the test_label_timespan</span>
        <span class="c1"># (above) to allow a buffer for labels and now we walk back further by the test_duration to</span>
        <span class="c1"># ensure we have a full set of test data in the latest test matrix.</span>
        <span class="c1">#</span>
        <span class="c1"># e.g., last_split_time = 2017-01-01 - 3month = 2016-10-01</span>
        <span class="n">test_delta</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">test_duration</span><span class="p">)</span>
        <span class="n">last_split_time</span> <span class="o">=</span> <span class="n">last_test_label_time</span> <span class="o">-</span> <span class="n">test_delta</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final split time: </span><span class="si">{</span><span class="n">last_split_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">last_split_time</span> <span class="o">&lt;</span> <span class="n">earliest_possible_split_time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid train/test split times in temporal config.&quot;</span><span class="p">)</span>

        <span class="n">train_test_split_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">train_test_split_time</span> <span class="o">=</span> <span class="n">last_split_time</span>

        <span class="c1"># finally, starting from our last_split_time, simply step backwards by the</span>
        <span class="c1"># model_update_frequency until we hit the earliest allowable time to</span>
        <span class="c1"># yield the set of train_test_split_times</span>
        <span class="c1">#</span>
        <span class="c1"># e.g., train_test_split_times for our example with a 1 year model_update_frequency</span>
        <span class="c1"># will be every Oct. 1 from 2012 to 2016:</span>
        <span class="c1"># train_test_split_times = [2012-10-01, 2013-10-01, 2014-10-01, 2015-10-01, 2016-10-01]</span>
        <span class="k">while</span> <span class="n">train_test_split_time</span> <span class="o">&gt;=</span> <span class="n">earliest_possible_split_time</span><span class="p">:</span>
            <span class="n">train_test_split_times</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_test_split_time</span><span class="p">)</span>
            <span class="n">train_test_split_time</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_update_frequency</span>

        <span class="k">return</span> <span class="n">train_test_split_times</span>

    <span class="c1"># matrix_end_time is now matrix_end_time - label_window</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_as_of_times</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">as_of_start_limit</span><span class="p">,</span> <span class="n">as_of_end_limit</span><span class="p">,</span> <span class="n">data_frequency</span><span class="p">,</span> <span class="n">forward</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Given a start and stop time, a frequncy, and a direction, calculate the</span>
<span class="sd">        as of times for a matrix.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            as_of_start_limit (datetime.datetime): the earliest possible as of time for a matrix</span>
<span class="sd">            as_of_end_limit (datetime.datetime): the last possible as of time for the matrix</span>
<span class="sd">            data_frequency (str): The time interval that should pass between rows</span>
<span class="sd">                of a single entity. Of the format `&#39;date unit&#39;`. For example,</span>
<span class="sd">                `&#39;1 month&#39;`.</span>
<span class="sd">            forward (boolean): whether to generate times forward from the start time</span>
<span class="sd">                            (True) or backward from the end time (False)</span>

<span class="sd">        return:</span>
<span class="sd">            list: list of as of times for the matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculating as_of_times from </span><span class="si">{</span><span class="n">as_of_start_limit</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">as_of_end_limit</span><span class="si">}</span><span class="s2"> using example frequency </span><span class="si">{</span><span class="n">data_frequency</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">as_of_times</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># in our example, this will apply to the test matrix with parameters</span>
        <span class="c1">#   as_of_start_limit = 2016-10-01, as_of_end_limit = 2017-01-01,</span>
        <span class="c1">#   data_frequency = 1month, forward=True</span>
        <span class="c1"># so, we&#39;ll start at 2016-10-01 and append this to the list of</span>
        <span class="c1"># as_of_times, then step forward one month at a time until we hit (but</span>
        <span class="c1"># do not include) 2017-01-01, yielding three values:</span>
        <span class="c1">#   [2016-10-01, 2016-11-01, 2016-12-01]</span>
        <span class="k">if</span> <span class="n">forward</span><span class="p">:</span>
            <span class="n">as_of_time</span> <span class="o">=</span> <span class="n">as_of_start_limit</span>
            <span class="c1"># essentially a do-while loop for test matrices since</span>
            <span class="c1"># identical start and end times should include the first</span>
            <span class="c1"># date (e.g., [&#39;2017-01-01&#39;, &#39;2017-01-01&#39;) should give</span>
            <span class="c1"># preference to the inclusive side)</span>
            <span class="n">as_of_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_of_time</span><span class="p">)</span>
            <span class="n">as_of_time</span> <span class="o">+=</span> <span class="n">data_frequency</span>
            <span class="k">while</span> <span class="n">as_of_time</span> <span class="o">&lt;</span> <span class="n">as_of_end_limit</span><span class="p">:</span>
                <span class="n">as_of_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_of_time</span><span class="p">)</span>
                <span class="n">as_of_time</span> <span class="o">+=</span> <span class="n">data_frequency</span>

        <span class="c1"># in our example, this will apply to the training matrix with parameters</span>
        <span class="c1">#   as_of_start_limit = 2014-04-01, as_of_end_limit = 2016-04-01,</span>
        <span class="c1">#   data_frequency = 1day, forward=False</span>
        <span class="c1"># so, we&#39;ll start from 2016-04-01 and step back by one day at a time</span>
        <span class="c1"># appending the results to the list of as_of_times until we hit 2014-04-01</span>
        <span class="c1"># (which will also be included)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">as_of_time</span> <span class="o">=</span> <span class="n">as_of_end_limit</span>
            <span class="k">while</span> <span class="n">as_of_time</span> <span class="o">&gt;=</span> <span class="n">as_of_start_limit</span><span class="p">:</span>
                <span class="n">as_of_times</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">as_of_time</span><span class="p">)</span>
                <span class="n">as_of_time</span> <span class="o">-=</span> <span class="n">data_frequency</span>

        <span class="k">return</span> <span class="n">as_of_times</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_matrix_definitions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">train_test_split_time</span><span class="p">,</span>
        <span class="n">training_as_of_date_frequency</span><span class="p">,</span>
        <span class="n">max_training_history</span><span class="p">,</span>
        <span class="n">test_duration</span><span class="p">,</span>
        <span class="n">training_label_timespan</span><span class="p">,</span>
        <span class="n">test_label_timespan</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Given a split time and parameters for train and test matrices,</span>
<span class="sd">        generate as of times and metadata for the matrices in the split.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            train_test_split_time (datetime.datetime): the limit of the last label in the matrix</span>
<span class="sd">            training_as_of_date_frequency (str): how much time between rows for an entity</span>
<span class="sd">                                            in a training matrix</span>
<span class="sd">            max_training_history (str): how far back from split do train</span>
<span class="sd">                                        as_of_times go</span>
<span class="sd">            test_duration (str): how far forward from split do test as_of_times go</span>
<span class="sd">            training_label_timespan (str): how much time covered by train labels</span>
<span class="sd">            test_label_timespan (str): how much time is covered by test labels</span>

<span class="sd">        returns:</span>
<span class="sd">            dict: dictionary defining the train and test matrices for a split</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># continuing our example, let&#39;s consider the case when this is called for the last</span>
        <span class="c1"># train_test_split_time, so the parameters here are:</span>
        <span class="c1">#   train_test_split_time = 2016-10-01</span>
        <span class="c1">#   training_as_of_date_frequency = 1day</span>
        <span class="c1">#   max_training_history = 2year</span>
        <span class="c1">#   test_duration = 3month</span>
        <span class="c1">#   training_label_timespan = 6month</span>
        <span class="c1">#   test_label_timespan = 6month</span>

        <span class="c1"># for the example, the train matrix will contain as_of_dates for every day from</span>
        <span class="c1"># 2014-04-01 through 2016-04-01, including _both_ endpoints, providing a 6 month</span>
        <span class="c1"># buffer between the last as_of_time and the train-test split time for the last</span>
        <span class="c1"># set of labels (see comments in the method for details)</span>
        <span class="n">train_matrix_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_train_matrix</span><span class="p">(</span>
            <span class="n">train_test_split_time</span><span class="o">=</span><span class="n">train_test_split_time</span><span class="p">,</span>
            <span class="n">training_label_timespan</span><span class="o">=</span><span class="n">training_label_timespan</span><span class="p">,</span>
            <span class="n">max_training_history</span><span class="o">=</span><span class="n">max_training_history</span><span class="p">,</span>
            <span class="n">training_as_of_date_frequency</span><span class="o">=</span><span class="n">training_as_of_date_frequency</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># for the example, the test matrix will contain three as_of_dates:</span>
        <span class="c1">#   [2016-10-01, 2016-11-01, 2016-12-01]</span>
        <span class="c1"># since we start at the train_test_split_time (2016-10-01) and walk forward by</span>
        <span class="c1"># the test_as_of_date_frequency (1 month) until we&#39;ve exhausted the test_duration</span>
        <span class="c1"># (3 months), exclusive (see comments in the method for details)</span>
        <span class="n">test_matrix_definitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_test_matrices</span><span class="p">(</span>
            <span class="n">train_test_split_time</span><span class="o">=</span><span class="n">train_test_split_time</span><span class="p">,</span>
            <span class="n">test_duration</span><span class="o">=</span><span class="n">test_duration</span><span class="p">,</span>
            <span class="n">test_label_timespan</span><span class="o">=</span><span class="n">test_label_timespan</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">matrix_set_definition</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;feature_start_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_start_time</span><span class="p">,</span>
            <span class="s2">&quot;feature_end_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_end_time</span><span class="p">,</span>
            <span class="s2">&quot;label_start_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_start_time</span><span class="p">,</span>
            <span class="s2">&quot;label_end_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_end_time</span><span class="p">,</span>
            <span class="s2">&quot;train_matrix&quot;</span><span class="p">:</span> <span class="n">train_matrix_definition</span><span class="p">,</span>
            <span class="s2">&quot;test_matrices&quot;</span><span class="p">:</span> <span class="n">test_matrix_definitions</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matrix definitions for train/test split </span><span class="si">{</span><span class="n">train_test_split_time</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">matrix_set_definition</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">matrix_set_definition</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">define_train_matrix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">train_test_split_time</span><span class="p">,</span>
        <span class="n">training_label_timespan</span><span class="p">,</span>
        <span class="n">max_training_history</span><span class="p">,</span>
        <span class="n">training_as_of_date_frequency</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Given a split time and the parameters of a training matrix, generate</span>
<span class="sd">        the as of times and metadata for a train matrix.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            train_test_split_time (datetime.datetime): the limit of the last label in the matrix</span>
<span class="sd">            training_label_timespan (str): how much time is covered by the labels</span>
<span class="sd">            max_training_history (str): how far back from split do as_of_times go</span>
<span class="sd">            training_as_of_date_frequency (str): how much time between rows for an entity</span>

<span class="sd">        return:</span>
<span class="sd">            dict: dictionary containing the temporal parameters and as of times</span>
<span class="sd">                  for a train matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating train matrix definitions for train/test split </span><span class="si">{</span><span class="n">train_test_split_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># for our example, this will be called with:</span>
        <span class="c1">#   train_test_split_time = 2016-10-01</span>
        <span class="c1">#   training_label_timespan = 6month</span>
        <span class="c1">#   max_training_history = 2year</span>
        <span class="c1">#   training_as_of_date_frequency = 1day</span>

        <span class="c1"># last as of time in the matrix is 1 label span before split to provide</span>
        <span class="c1"># enough of a buffer for the label data to avoid spilling into the test</span>
        <span class="c1"># matrix and causing a leakage problem.</span>
        <span class="c1">#</span>
        <span class="c1"># e.g., last_train_as_of_time = 2016-10-01 - 6month = 2016-04-01</span>
        <span class="n">training_prediction_delta</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span>
            <span class="n">training_label_timespan</span>
        <span class="p">)</span>
        <span class="n">last_train_as_of_time</span> <span class="o">=</span> <span class="n">train_test_split_time</span> <span class="o">-</span> <span class="n">training_prediction_delta</span>

        <span class="c1"># earliest time in matrix can&#39;t be farther back than the latest of the beginning</span>
        <span class="c1"># of label time or the beginning of feature time -- whichever is latest is the</span>
        <span class="c1"># limit if the amount of history we want to take would go further back.</span>
        <span class="c1">#</span>
        <span class="c1"># e.g., 2016-04-01 - 2year = 2014-04-01, which is later than both our</span>
        <span class="c1"># label_start_time (2012-01-01) and our feature_start_time (1995-01-01), so we</span>
        <span class="c1"># can use earliest_possible_train_as_of_time = 2014-04-01</span>
        <span class="n">max_training_delta</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">max_training_history</span><span class="p">)</span>
        <span class="n">earliest_possible_train_as_of_time</span> <span class="o">=</span> <span class="n">last_train_as_of_time</span> <span class="o">-</span> <span class="n">max_training_delta</span>
        <span class="n">experiment_as_of_time_limit</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_start_time</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">earliest_possible_train_as_of_time</span> <span class="o">&lt;</span> <span class="n">experiment_as_of_time_limit</span><span class="p">:</span>
            <span class="n">earliest_possible_train_as_of_time</span> <span class="o">=</span> <span class="n">experiment_as_of_time_limit</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Earliest possible train as of time: </span><span class="si">{</span><span class="n">earliest_possible_train_as_of_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># with the last as of time and the earliest possible time known,</span>
        <span class="c1"># calculate all the as of times for the matrix, stepping backwards</span>
        <span class="c1"># from the last as of time (to ensure that we use the latest possible</span>
        <span class="c1"># training data even if there&#39;s a gap and things don&#39;t line up</span>
        <span class="c1"># exactly) by the training_as_of_date_frequency</span>
        <span class="c1">#</span>
        <span class="c1"># for our example, this will give us a list of every day from 2014-04-01</span>
        <span class="c1"># through 2016-04-01, including _both_ endpoints</span>
        <span class="n">train_as_of_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_as_of_times</span><span class="p">(</span>
            <span class="n">as_of_start_limit</span><span class="o">=</span><span class="n">earliest_possible_train_as_of_time</span><span class="p">,</span>
            <span class="n">as_of_end_limit</span><span class="o">=</span><span class="n">last_train_as_of_time</span><span class="p">,</span>
            <span class="n">data_frequency</span><span class="o">=</span><span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">training_as_of_date_frequency</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train as of times: </span><span class="si">{</span><span class="n">train_as_of_times</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># create a dict of the matrix metadata</span>
        <span class="n">matrix_definition</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;first_as_of_time&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">train_as_of_times</span><span class="p">),</span>
            <span class="s2">&quot;last_as_of_time&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_as_of_times</span><span class="p">),</span>
            <span class="s2">&quot;matrix_info_end_time&quot;</span><span class="p">:</span> <span class="n">train_test_split_time</span><span class="p">,</span>
            <span class="s2">&quot;as_of_times&quot;</span><span class="p">:</span> <span class="n">AsOfTimeList</span><span class="p">(</span><span class="n">train_as_of_times</span><span class="p">),</span>
            <span class="s2">&quot;training_label_timespan&quot;</span><span class="p">:</span> <span class="n">training_label_timespan</span><span class="p">,</span>
            <span class="s2">&quot;training_as_of_date_frequency&quot;</span><span class="p">:</span> <span class="n">training_as_of_date_frequency</span><span class="p">,</span>
            <span class="s2">&quot;max_training_history&quot;</span><span class="p">:</span> <span class="n">max_training_history</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">matrix_definition</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">define_test_matrices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">train_test_split_time</span><span class="p">,</span> <span class="n">test_duration</span><span class="p">,</span> <span class="n">test_label_timespan</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Given a train/test split time and a set of testing parameters,</span>
<span class="sd">        generate the metadata and as of times for the test matrices in a split.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            train_test_split_time (datetime.datetime): the limit of the last label in the matrix</span>
<span class="sd">            test_duration (str): how far forward from split do test as_of_times go</span>
<span class="sd">            test_label_timespan (str): how much time is covered by test labels</span>

<span class="sd">        return:</span>
<span class="sd">            list: list of dictionaries defining the test matrices for a split</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># for our example, this will be called with:</span>
        <span class="c1">#   train_test_split_time = 2016-10-01</span>
        <span class="c1">#   test_duration = 3month</span>
        <span class="c1">#   test_label_timespan = 6month</span>

        <span class="c1"># the as_of_time_limit is simply the split time plus the test_duration and we</span>
        <span class="c1"># can avoid checking here for any issues with the label_end_time or</span>
        <span class="c1"># feature_end_time since we&#39;ve guaranteed that those limits would be</span>
        <span class="c1"># satisfied when we calculated the train_test_split_times initially</span>
        <span class="c1">#</span>
        <span class="c1"># for the example, as_of_time_limit = 2016-10-01 + 3month = 2017-01-01</span>
        <span class="c1"># (note as well that this will be treated as an _exclusive_ limit)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating test matrix definitions for train/test split </span><span class="si">{</span><span class="n">train_test_split_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">test_definitions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">test_delta</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">test_duration</span><span class="p">)</span>
        <span class="n">as_of_time_limit</span> <span class="o">=</span> <span class="n">train_test_split_time</span> <span class="o">+</span> <span class="n">test_delta</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="s2">&quot;All test as of times before </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">as_of_time_limit</span><span class="p">)</span>

        <span class="c1"># calculate the as_of_times associated with each test data frequency</span>
        <span class="c1"># for our example, we just have one, 1month</span>
        <span class="k">for</span> <span class="n">test_as_of_date_frequency</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_as_of_date_frequencies</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating test matrix definitions for test data frequency </span><span class="si">{</span><span class="n">test_as_of_date_frequency</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># for test as_of_times we step _forwards_ from the train_test_split_time</span>
            <span class="c1"># to ensure that we always have a prediction set made immediately after</span>
            <span class="c1"># training is done (so, the freshest possible predictions) even if the</span>
            <span class="c1"># frequency doesn&#39;t divide the test_duration evenly so there&#39;s a gap before</span>
            <span class="c1"># the as_of_time_limit</span>
            <span class="c1">#</span>
            <span class="c1"># for our example, this will give three as_of_dates:</span>
            <span class="c1">#   [2016-10-01, 2016-11-01, 2016-12-01]</span>
            <span class="c1"># since we start at the train_test_split_time (2016-10-01) and walk forward by</span>
            <span class="c1"># the test_as_of_date_frequency (1 month) until we&#39;ve exhausted the test_duration</span>
            <span class="c1"># (3 months), exclusive (see comments in the method for details)</span>
            <span class="n">test_as_of_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_as_of_times</span><span class="p">(</span>
                <span class="n">as_of_start_limit</span><span class="o">=</span><span class="n">train_test_split_time</span><span class="p">,</span>
                <span class="n">as_of_end_limit</span><span class="o">=</span><span class="n">as_of_time_limit</span><span class="p">,</span>
                <span class="n">data_frequency</span><span class="o">=</span><span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">test_as_of_date_frequency</span><span class="p">),</span>
                <span class="n">forward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test as of times: </span><span class="si">{</span><span class="n">test_as_of_times</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">test_definition</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;first_as_of_time&quot;</span><span class="p">:</span> <span class="n">train_test_split_time</span><span class="p">,</span>
                <span class="s2">&quot;last_as_of_time&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">test_as_of_times</span><span class="p">),</span>
                <span class="s2">&quot;matrix_info_end_time&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">test_as_of_times</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">test_label_timespan</span><span class="p">),</span>
                <span class="s2">&quot;as_of_times&quot;</span><span class="p">:</span> <span class="n">AsOfTimeList</span><span class="p">(</span><span class="n">test_as_of_times</span><span class="p">),</span>
                <span class="s2">&quot;test_label_timespan&quot;</span><span class="p">:</span> <span class="n">test_label_timespan</span><span class="p">,</span>
                <span class="s2">&quot;test_as_of_date_frequency&quot;</span><span class="p">:</span> <span class="n">test_as_of_date_frequency</span><span class="p">,</span>
                <span class="s2">&quot;test_duration&quot;</span><span class="p">:</span> <span class="n">test_duration</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">test_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_definition</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">test_definitions</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h4 id="triage.component.timechop.timechop.Timechop-attributes">Attributes<a href="#triage.component.timechop.timechop.Timechop-attributes" class="headerlink" title="Permanent link">#</a></h4>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.feature_end_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">feature_end_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span><span class="n">feature_end_time</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.feature_end_time" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.feature_start_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">feature_start_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span><span class="n">feature_start_time</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.feature_start_time" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.label_end_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">label_end_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span><span class="n">label_end_time</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.label_end_time" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.label_start_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">label_start_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span><span class="n">label_start_time</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.label_start_time" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.max_training_histories" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">max_training_histories</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">max_training_histories</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.max_training_histories" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.model_update_frequency" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model_update_frequency</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">model_update_frequency</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.model_update_frequency" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.test_as_of_date_frequencies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_as_of_date_frequencies</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">test_as_of_date_frequencies</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.test_as_of_date_frequencies" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.test_durations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_durations</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">test_durations</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.test_durations" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.test_label_timespans" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_label_timespans</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">test_label_timespans</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.test_label_timespans" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.training_as_of_date_frequencies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">training_as_of_date_frequencies</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">training_as_of_date_frequencies</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.training_as_of_date_frequencies" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="triage.component.timechop.timechop.Timechop.training_label_timespans" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">training_label_timespans</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">training_label_timespans</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#triage.component.timechop.timechop.Timechop.training_label_timespans" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

    </div>

</div>

<h4 id="triage.component.timechop.timechop.Timechop-functions">Functions<a href="#triage.component.timechop.timechop.Timechop-functions" class="headerlink" title="Permanent link">#</a></h4>

<div class="doc doc-object doc-function">


<h5 id="triage.component.timechop.timechop.Timechop.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">feature_start_time</span><span class="p">,</span> <span class="n">feature_end_time</span><span class="p">,</span> <span class="n">label_start_time</span><span class="p">,</span> <span class="n">label_end_time</span><span class="p">,</span> <span class="n">model_update_frequency</span><span class="p">,</span> <span class="n">training_as_of_date_frequencies</span><span class="p">,</span> <span class="n">max_training_histories</span><span class="p">,</span> <span class="n">training_label_timespans</span><span class="p">,</span> <span class="n">test_as_of_date_frequencies</span><span class="p">,</span> <span class="n">test_durations</span><span class="p">,</span> <span class="n">test_label_timespans</span><span class="p">)</span></code>

<a href="#triage.component.timechop.timechop.Timechop.__init__" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

        <p>Date strings should follow the format <code>YYYY-MM-DD</code>. Date intervals
should be strings of the Postgres interval input format.</p>
<p>This class is often used within the Triage experiment pipeline, and
initialized using parameters from a Triage <a href="../../../experiments/experiment-config/#time-splitting">experiment config</a></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>feature_start_time</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Earliest date included in any feature</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_end_time</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Day after last feature date (all data
included in features are before this date)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label_start_time</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Earliest date for which labels are available</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label_end_time</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Day AFTER last label date (all dates in any
model are before this date)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_update_frequency</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how frequently to retrain models</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>training_as_of_date_frequencies</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time between rows for same
entity in train matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_training_histories</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interval specifying how much history
for each entity to train on</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>training_label_timespans</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how much time is included in a label
in the train matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_as_of_date_frequencies</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time between rows for same entity
in test matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_durations</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How long into the future to make predictions
for each entity. Controls the length of time included in a test
matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_label_timespans</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How much time is included in a label
in the test matrix.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/triage/component/timechop/timechop.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">feature_start_time</span><span class="p">,</span>
    <span class="n">feature_end_time</span><span class="p">,</span>
    <span class="n">label_start_time</span><span class="p">,</span>
    <span class="n">label_end_time</span><span class="p">,</span>
    <span class="n">model_update_frequency</span><span class="p">,</span>
    <span class="n">training_as_of_date_frequencies</span><span class="p">,</span>
    <span class="n">max_training_histories</span><span class="p">,</span>
    <span class="n">training_label_timespans</span><span class="p">,</span>
    <span class="n">test_as_of_date_frequencies</span><span class="p">,</span>
    <span class="n">test_durations</span><span class="p">,</span>
    <span class="n">test_label_timespans</span><span class="p">,</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Date strings should follow the format `YYYY-MM-DD`. Date intervals</span>
<span class="sd">    should be strings of the Postgres interval input format.</span>

<span class="sd">    This class is often used within the Triage experiment pipeline, and</span>
<span class="sd">    initialized using parameters from a Triage [experiment config](../../../experiments/experiment-config/#time-splitting)</span>

<span class="sd">    Arguments:</span>
<span class="sd">        feature_start_time (str): Earliest date included in any feature</span>
<span class="sd">        feature_end_time (str): Day after last feature date (all data</span>
<span class="sd">            included in features are before this date)</span>
<span class="sd">        label_start_time (str): Earliest date for which labels are available</span>
<span class="sd">        label_end_time (str): Day AFTER last label date (all dates in any</span>
<span class="sd">            model are before this date)</span>
<span class="sd">        model_update_frequency (str): how frequently to retrain models</span>
<span class="sd">        training_as_of_date_frequencies (str): time between rows for same</span>
<span class="sd">            entity in train matrix</span>
<span class="sd">        max_training_histories (str): Interval specifying how much history</span>
<span class="sd">            for each entity to train on</span>
<span class="sd">        training_label_timespans (str): how much time is included in a label</span>
<span class="sd">            in the train matrix</span>
<span class="sd">        test_as_of_date_frequencies (str): time between rows for same entity</span>
<span class="sd">            in test matrix</span>
<span class="sd">        test_durations (str): How long into the future to make predictions</span>
<span class="sd">            for each entity. Controls the length of time included in a test</span>
<span class="sd">            matrix</span>
<span class="sd">        test_label_timespans (str): How much time is included in a label</span>
<span class="sd">            in the test matrix.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_start_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span>
        <span class="n">feature_start_time</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_end_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span>
        <span class="n">feature_end_time</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_start_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_end_time</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Feature start time after feature end time.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">label_start_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span>
        <span class="n">label_start_time</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">label_end_time</span> <span class="o">=</span> <span class="n">dt_from_str</span><span class="p">(</span>
        <span class="n">label_end_time</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_start_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_end_time</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Label start time after label end time.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">model_update_frequency</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span>
        <span class="n">model_update_frequency</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">training_as_of_date_frequencies</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span>
        <span class="n">training_as_of_date_frequencies</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">test_as_of_date_frequencies</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span>
        <span class="n">test_as_of_date_frequencies</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">max_training_histories</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">max_training_histories</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">test_durations</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">test_durations</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">training_label_timespans</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">training_label_timespans</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">test_label_timespans</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_to_list</span><span class="p">(</span><span class="n">test_label_timespans</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="triage.component.timechop.timechop.Timechop.calculate_as_of_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_as_of_times</span><span class="p">(</span><span class="n">as_of_start_limit</span><span class="p">,</span> <span class="n">as_of_end_limit</span><span class="p">,</span> <span class="n">data_frequency</span><span class="p">,</span> <span class="n">forward</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#triage.component.timechop.timechop.Timechop.calculate_as_of_times" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

        <p>Given a start and stop time, a frequncy, and a direction, calculate the
as of times for a matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>as_of_start_limit</code>
            </td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the earliest possible as of time for a matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_of_end_limit</code>
            </td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the last possible as of time for the matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_frequency</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time interval that should pass between rows
of a single entity. Of the format <code>'date unit'</code>. For example,
<code>'1 month'</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forward</code>
            </td>
            <td>
                  <code><span title="boolean">boolean</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to generate times forward from the start time
            (True) or backward from the end time (False)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="return" open>
  <summary>return</summary>
  
</details>

            <details class="quote">
              <summary>Source code in <code>src/triage/component/timechop/timechop.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_as_of_times</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">as_of_start_limit</span><span class="p">,</span> <span class="n">as_of_end_limit</span><span class="p">,</span> <span class="n">data_frequency</span><span class="p">,</span> <span class="n">forward</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given a start and stop time, a frequncy, and a direction, calculate the</span>
<span class="sd">    as of times for a matrix.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        as_of_start_limit (datetime.datetime): the earliest possible as of time for a matrix</span>
<span class="sd">        as_of_end_limit (datetime.datetime): the last possible as of time for the matrix</span>
<span class="sd">        data_frequency (str): The time interval that should pass between rows</span>
<span class="sd">            of a single entity. Of the format `&#39;date unit&#39;`. For example,</span>
<span class="sd">            `&#39;1 month&#39;`.</span>
<span class="sd">        forward (boolean): whether to generate times forward from the start time</span>
<span class="sd">                        (True) or backward from the end time (False)</span>

<span class="sd">    return:</span>
<span class="sd">        list: list of as of times for the matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculating as_of_times from </span><span class="si">{</span><span class="n">as_of_start_limit</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">as_of_end_limit</span><span class="si">}</span><span class="s2"> using example frequency </span><span class="si">{</span><span class="n">data_frequency</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">as_of_times</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># in our example, this will apply to the test matrix with parameters</span>
    <span class="c1">#   as_of_start_limit = 2016-10-01, as_of_end_limit = 2017-01-01,</span>
    <span class="c1">#   data_frequency = 1month, forward=True</span>
    <span class="c1"># so, we&#39;ll start at 2016-10-01 and append this to the list of</span>
    <span class="c1"># as_of_times, then step forward one month at a time until we hit (but</span>
    <span class="c1"># do not include) 2017-01-01, yielding three values:</span>
    <span class="c1">#   [2016-10-01, 2016-11-01, 2016-12-01]</span>
    <span class="k">if</span> <span class="n">forward</span><span class="p">:</span>
        <span class="n">as_of_time</span> <span class="o">=</span> <span class="n">as_of_start_limit</span>
        <span class="c1"># essentially a do-while loop for test matrices since</span>
        <span class="c1"># identical start and end times should include the first</span>
        <span class="c1"># date (e.g., [&#39;2017-01-01&#39;, &#39;2017-01-01&#39;) should give</span>
        <span class="c1"># preference to the inclusive side)</span>
        <span class="n">as_of_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_of_time</span><span class="p">)</span>
        <span class="n">as_of_time</span> <span class="o">+=</span> <span class="n">data_frequency</span>
        <span class="k">while</span> <span class="n">as_of_time</span> <span class="o">&lt;</span> <span class="n">as_of_end_limit</span><span class="p">:</span>
            <span class="n">as_of_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_of_time</span><span class="p">)</span>
            <span class="n">as_of_time</span> <span class="o">+=</span> <span class="n">data_frequency</span>

    <span class="c1"># in our example, this will apply to the training matrix with parameters</span>
    <span class="c1">#   as_of_start_limit = 2014-04-01, as_of_end_limit = 2016-04-01,</span>
    <span class="c1">#   data_frequency = 1day, forward=False</span>
    <span class="c1"># so, we&#39;ll start from 2016-04-01 and step back by one day at a time</span>
    <span class="c1"># appending the results to the list of as_of_times until we hit 2014-04-01</span>
    <span class="c1"># (which will also be included)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">as_of_time</span> <span class="o">=</span> <span class="n">as_of_end_limit</span>
        <span class="k">while</span> <span class="n">as_of_time</span> <span class="o">&gt;=</span> <span class="n">as_of_start_limit</span><span class="p">:</span>
            <span class="n">as_of_times</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">as_of_time</span><span class="p">)</span>
            <span class="n">as_of_time</span> <span class="o">-=</span> <span class="n">data_frequency</span>

    <span class="k">return</span> <span class="n">as_of_times</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="triage.component.timechop.timechop.Timechop.calculate_train_test_split_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_train_test_split_times</span><span class="p">(</span><span class="n">training_label_timespan</span><span class="p">,</span> <span class="n">test_label_timespan</span><span class="p">,</span> <span class="n">test_duration</span><span class="p">)</span></code>

<a href="#triage.component.timechop.timechop.Timechop.calculate_train_test_split_times" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

        <p>Calculate the split times between train and test matrices. All
label spans in train matrices will end at this time, and this will be
the first as of time in the respective test matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>training_label_timespan</code>
            </td>
            <td>
                  <code><span title="dateutil.relativedelta.relativedelta">relativedelta</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how much
time is included in training labels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_label_timespan</code>
            </td>
            <td>
                  <code><span title="dateutil.relativedelta.relativedelta">relativedelta</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how much time is included in test labels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_duration</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>for how long after the end of a training matrix are
test predictions made</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all split times for the temporal parameters</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        


            <details class="quote">
              <summary>Source code in <code>src/triage/component/timechop/timechop.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_train_test_split_times</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">training_label_timespan</span><span class="p">,</span> <span class="n">test_label_timespan</span><span class="p">,</span> <span class="n">test_duration</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the split times between train and test matrices. All</span>
<span class="sd">    label spans in train matrices will end at this time, and this will be</span>
<span class="sd">    the first as of time in the respective test matrix.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        training_label_timespan (dateutil.relativedelta.relativedelta): how much</span>
<span class="sd">            time is included in training labels</span>
<span class="sd">        test_label_timespan (dateutil.relativedelta.relativedelta): how much time is included in test labels</span>
<span class="sd">        test_duration (str): for how long after the end of a training matrix are</span>
<span class="sd">            test predictions made</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: all split times for the temporal parameters</span>
<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if there are no valid split times in the temporal</span>
<span class="sd">        config</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># we always want to be sure we&#39;re using the most recent data, so for the splits,</span>
    <span class="c1"># we start from the very end of time for which we have labels and walk backwards,</span>
    <span class="c1"># ensuring we leave enough of a buffer for the test_label_timespan to get a full</span>
    <span class="c1"># set of labels for our last testing as_of_date</span>
    <span class="c1">#</span>
    <span class="c1"># in our example, last_test_label_time = 2017-07-01 - 6month = 2017-01-01</span>
    <span class="n">last_test_label_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_end_time</span> <span class="o">-</span> <span class="n">test_label_timespan</span>

    <span class="c1"># final label must be able to have feature data associated with it</span>
    <span class="k">if</span> <span class="n">last_test_label_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_end_time</span><span class="p">:</span>
        <span class="n">last_test_label_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_end_time</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Final test label date cannot be after end of feature time.&quot;</span>
        <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final label as of date: </span><span class="si">{</span><span class="n">last_test_label_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># all split times have to allow at least one training label before them</span>
    <span class="c1"># e.g., earliest_possible_split_time = max(1995-01-01, 2012-01-01) + 6month = 2012-01-01</span>
    <span class="n">earliest_possible_split_time</span> <span class="o">=</span> <span class="n">training_label_timespan</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_start_time</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Earliest possible train/test split time: </span><span class="si">{</span><span class="n">earliest_possible_split_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># last split is the first as of time in the final test matrix</span>
    <span class="c1"># that is, starting from the label_end_time, we&#39;ve walked back by the test_label_timespan</span>
    <span class="c1"># (above) to allow a buffer for labels and now we walk back further by the test_duration to</span>
    <span class="c1"># ensure we have a full set of test data in the latest test matrix.</span>
    <span class="c1">#</span>
    <span class="c1"># e.g., last_split_time = 2017-01-01 - 3month = 2016-10-01</span>
    <span class="n">test_delta</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">test_duration</span><span class="p">)</span>
    <span class="n">last_split_time</span> <span class="o">=</span> <span class="n">last_test_label_time</span> <span class="o">-</span> <span class="n">test_delta</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final split time: </span><span class="si">{</span><span class="n">last_split_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">last_split_time</span> <span class="o">&lt;</span> <span class="n">earliest_possible_split_time</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid train/test split times in temporal config.&quot;</span><span class="p">)</span>

    <span class="n">train_test_split_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">train_test_split_time</span> <span class="o">=</span> <span class="n">last_split_time</span>

    <span class="c1"># finally, starting from our last_split_time, simply step backwards by the</span>
    <span class="c1"># model_update_frequency until we hit the earliest allowable time to</span>
    <span class="c1"># yield the set of train_test_split_times</span>
    <span class="c1">#</span>
    <span class="c1"># e.g., train_test_split_times for our example with a 1 year model_update_frequency</span>
    <span class="c1"># will be every Oct. 1 from 2012 to 2016:</span>
    <span class="c1"># train_test_split_times = [2012-10-01, 2013-10-01, 2014-10-01, 2015-10-01, 2016-10-01]</span>
    <span class="k">while</span> <span class="n">train_test_split_time</span> <span class="o">&gt;=</span> <span class="n">earliest_possible_split_time</span><span class="p">:</span>
        <span class="n">train_test_split_times</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_test_split_time</span><span class="p">)</span>
        <span class="n">train_test_split_time</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_update_frequency</span>

    <span class="k">return</span> <span class="n">train_test_split_times</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="triage.component.timechop.timechop.Timechop.chop_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chop_time</span><span class="p">()</span></code>

<a href="#triage.component.timechop.timechop.Timechop.chop_time" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

        <p>Given the attributes of the object, define all train/test splits
for all combinations of the temporal parameters.</p>


<details class="return" open>
  <summary>return</summary>
  
</details>

            <details class="quote">
              <summary>Source code in <code>src/triage/component/timechop/timechop.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chop_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given the attributes of the object, define all train/test splits</span>
<span class="sd">    for all combinations of the temporal parameters.</span>

<span class="sd">    return:</span>
<span class="sd">        list: a list of dictionaries defining train/test splits</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matrix_set_definitions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># in our example, we just have one value for each of these: 6month, 6month, and 3month</span>
    <span class="k">for</span> <span class="p">(</span>
        <span class="n">training_label_timespan</span><span class="p">,</span>
        <span class="n">test_label_timespan</span><span class="p">,</span>
        <span class="n">test_duration</span><span class="p">,</span>
    <span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training_label_timespans</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_label_timespans</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_durations</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># calculating the train-test split times starts from the end and walks backwards</span>
        <span class="c1"># e.g., train_test_split_times for our example with a 1 year model_update_frequency</span>
        <span class="c1"># will be every Oct. 1 from 2012 to 2016 (see comments in the method for details</span>
        <span class="c1"># on the calculation):</span>
        <span class="c1"># train_test_split_times = [2012-10-01, 2013-10-01, 2014-10-01, 2015-10-01, 2016-10-01]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Calculating train/test split times for training prediction span </span><span class="si">{</span><span class="n">training_label_timespan</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;test prediction span </span><span class="si">{</span><span class="n">test_label_timespan</span><span class="si">}</span><span class="s2">, test span </span><span class="si">{</span><span class="n">test_duration</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">train_test_split_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_train_test_split_times</span><span class="p">(</span>
            <span class="n">training_label_timespan</span><span class="o">=</span><span class="n">convert_str_to_relativedelta</span><span class="p">(</span>
                <span class="n">training_label_timespan</span>
            <span class="p">),</span>
            <span class="n">test_label_timespan</span><span class="o">=</span><span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">test_label_timespan</span><span class="p">),</span>
            <span class="n">test_duration</span><span class="o">=</span><span class="n">test_duration</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train/test split times: </span><span class="si">{</span><span class="n">train_test_split_times</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># handle each training_as_of_date_frequency and max_training_history separately</span>
        <span class="c1"># to create matrices for each train_test_split_time.</span>
        <span class="c1"># in our example, we only have one value for each: 1day and 2year</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">training_as_of_date_frequency</span><span class="p">,</span>
            <span class="n">max_training_history</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">training_as_of_date_frequencies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_training_histories</span>
        <span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Generating matrix definitions for training_as_of_date_frequency </span><span class="si">{</span><span class="n">training_as_of_date_frequency</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;max_training_history </span><span class="si">{</span><span class="n">max_training_history</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">train_test_split_time</span> <span class="ow">in</span> <span class="n">train_test_split_times</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating matrix definitions for split </span><span class="si">{</span><span class="n">train_test_split_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">matrix_set_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">generate_matrix_definitions</span><span class="p">(</span>
                        <span class="n">train_test_split_time</span><span class="o">=</span><span class="n">train_test_split_time</span><span class="p">,</span>
                        <span class="n">training_as_of_date_frequency</span><span class="o">=</span><span class="n">training_as_of_date_frequency</span><span class="p">,</span>
                        <span class="n">max_training_history</span><span class="o">=</span><span class="n">max_training_history</span><span class="p">,</span>
                        <span class="n">test_duration</span><span class="o">=</span><span class="n">test_duration</span><span class="p">,</span>
                        <span class="n">training_label_timespan</span><span class="o">=</span><span class="n">training_label_timespan</span><span class="p">,</span>
                        <span class="n">test_label_timespan</span><span class="o">=</span><span class="n">test_label_timespan</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
    <span class="k">return</span> <span class="n">matrix_set_definitions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="triage.component.timechop.timechop.Timechop.define_test_matrices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">define_test_matrices</span><span class="p">(</span><span class="n">train_test_split_time</span><span class="p">,</span> <span class="n">test_duration</span><span class="p">,</span> <span class="n">test_label_timespan</span><span class="p">)</span></code>

<a href="#triage.component.timechop.timechop.Timechop.define_test_matrices" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

        <p>Given a train/test split time and a set of testing parameters,
generate the metadata and as of times for the test matrices in a split.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>train_test_split_time</code>
            </td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the limit of the last label in the matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_duration</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how far forward from split do test as_of_times go</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_label_timespan</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how much time is covered by test labels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="return" open>
  <summary>return</summary>
  
</details>

            <details class="quote">
              <summary>Source code in <code>src/triage/component/timechop/timechop.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">define_test_matrices</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">train_test_split_time</span><span class="p">,</span> <span class="n">test_duration</span><span class="p">,</span> <span class="n">test_label_timespan</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given a train/test split time and a set of testing parameters,</span>
<span class="sd">    generate the metadata and as of times for the test matrices in a split.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        train_test_split_time (datetime.datetime): the limit of the last label in the matrix</span>
<span class="sd">        test_duration (str): how far forward from split do test as_of_times go</span>
<span class="sd">        test_label_timespan (str): how much time is covered by test labels</span>

<span class="sd">    return:</span>
<span class="sd">        list: list of dictionaries defining the test matrices for a split</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># for our example, this will be called with:</span>
    <span class="c1">#   train_test_split_time = 2016-10-01</span>
    <span class="c1">#   test_duration = 3month</span>
    <span class="c1">#   test_label_timespan = 6month</span>

    <span class="c1"># the as_of_time_limit is simply the split time plus the test_duration and we</span>
    <span class="c1"># can avoid checking here for any issues with the label_end_time or</span>
    <span class="c1"># feature_end_time since we&#39;ve guaranteed that those limits would be</span>
    <span class="c1"># satisfied when we calculated the train_test_split_times initially</span>
    <span class="c1">#</span>
    <span class="c1"># for the example, as_of_time_limit = 2016-10-01 + 3month = 2017-01-01</span>
    <span class="c1"># (note as well that this will be treated as an _exclusive_ limit)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating test matrix definitions for train/test split </span><span class="si">{</span><span class="n">train_test_split_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">test_definitions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">test_delta</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">test_duration</span><span class="p">)</span>
    <span class="n">as_of_time_limit</span> <span class="o">=</span> <span class="n">train_test_split_time</span> <span class="o">+</span> <span class="n">test_delta</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="s2">&quot;All test as of times before </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">as_of_time_limit</span><span class="p">)</span>

    <span class="c1"># calculate the as_of_times associated with each test data frequency</span>
    <span class="c1"># for our example, we just have one, 1month</span>
    <span class="k">for</span> <span class="n">test_as_of_date_frequency</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_as_of_date_frequencies</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating test matrix definitions for test data frequency </span><span class="si">{</span><span class="n">test_as_of_date_frequency</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># for test as_of_times we step _forwards_ from the train_test_split_time</span>
        <span class="c1"># to ensure that we always have a prediction set made immediately after</span>
        <span class="c1"># training is done (so, the freshest possible predictions) even if the</span>
        <span class="c1"># frequency doesn&#39;t divide the test_duration evenly so there&#39;s a gap before</span>
        <span class="c1"># the as_of_time_limit</span>
        <span class="c1">#</span>
        <span class="c1"># for our example, this will give three as_of_dates:</span>
        <span class="c1">#   [2016-10-01, 2016-11-01, 2016-12-01]</span>
        <span class="c1"># since we start at the train_test_split_time (2016-10-01) and walk forward by</span>
        <span class="c1"># the test_as_of_date_frequency (1 month) until we&#39;ve exhausted the test_duration</span>
        <span class="c1"># (3 months), exclusive (see comments in the method for details)</span>
        <span class="n">test_as_of_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_as_of_times</span><span class="p">(</span>
            <span class="n">as_of_start_limit</span><span class="o">=</span><span class="n">train_test_split_time</span><span class="p">,</span>
            <span class="n">as_of_end_limit</span><span class="o">=</span><span class="n">as_of_time_limit</span><span class="p">,</span>
            <span class="n">data_frequency</span><span class="o">=</span><span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">test_as_of_date_frequency</span><span class="p">),</span>
            <span class="n">forward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test as of times: </span><span class="si">{</span><span class="n">test_as_of_times</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">test_definition</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;first_as_of_time&quot;</span><span class="p">:</span> <span class="n">train_test_split_time</span><span class="p">,</span>
            <span class="s2">&quot;last_as_of_time&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">test_as_of_times</span><span class="p">),</span>
            <span class="s2">&quot;matrix_info_end_time&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">test_as_of_times</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">test_label_timespan</span><span class="p">),</span>
            <span class="s2">&quot;as_of_times&quot;</span><span class="p">:</span> <span class="n">AsOfTimeList</span><span class="p">(</span><span class="n">test_as_of_times</span><span class="p">),</span>
            <span class="s2">&quot;test_label_timespan&quot;</span><span class="p">:</span> <span class="n">test_label_timespan</span><span class="p">,</span>
            <span class="s2">&quot;test_as_of_date_frequency&quot;</span><span class="p">:</span> <span class="n">test_as_of_date_frequency</span><span class="p">,</span>
            <span class="s2">&quot;test_duration&quot;</span><span class="p">:</span> <span class="n">test_duration</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">test_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_definition</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_definitions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="triage.component.timechop.timechop.Timechop.define_train_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">define_train_matrix</span><span class="p">(</span><span class="n">train_test_split_time</span><span class="p">,</span> <span class="n">training_label_timespan</span><span class="p">,</span> <span class="n">max_training_history</span><span class="p">,</span> <span class="n">training_as_of_date_frequency</span><span class="p">)</span></code>

<a href="#triage.component.timechop.timechop.Timechop.define_train_matrix" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

        <p>Given a split time and the parameters of a training matrix, generate
the as of times and metadata for a train matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>train_test_split_time</code>
            </td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the limit of the last label in the matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>training_label_timespan</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how much time is covered by the labels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_training_history</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how far back from split do as_of_times go</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>training_as_of_date_frequency</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how much time between rows for an entity</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="return" open>
  <summary>return</summary>
  
</details>

            <details class="quote">
              <summary>Source code in <code>src/triage/component/timechop/timechop.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">define_train_matrix</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">train_test_split_time</span><span class="p">,</span>
    <span class="n">training_label_timespan</span><span class="p">,</span>
    <span class="n">max_training_history</span><span class="p">,</span>
    <span class="n">training_as_of_date_frequency</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given a split time and the parameters of a training matrix, generate</span>
<span class="sd">    the as of times and metadata for a train matrix.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        train_test_split_time (datetime.datetime): the limit of the last label in the matrix</span>
<span class="sd">        training_label_timespan (str): how much time is covered by the labels</span>
<span class="sd">        max_training_history (str): how far back from split do as_of_times go</span>
<span class="sd">        training_as_of_date_frequency (str): how much time between rows for an entity</span>

<span class="sd">    return:</span>
<span class="sd">        dict: dictionary containing the temporal parameters and as of times</span>
<span class="sd">              for a train matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating train matrix definitions for train/test split </span><span class="si">{</span><span class="n">train_test_split_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># for our example, this will be called with:</span>
    <span class="c1">#   train_test_split_time = 2016-10-01</span>
    <span class="c1">#   training_label_timespan = 6month</span>
    <span class="c1">#   max_training_history = 2year</span>
    <span class="c1">#   training_as_of_date_frequency = 1day</span>

    <span class="c1"># last as of time in the matrix is 1 label span before split to provide</span>
    <span class="c1"># enough of a buffer for the label data to avoid spilling into the test</span>
    <span class="c1"># matrix and causing a leakage problem.</span>
    <span class="c1">#</span>
    <span class="c1"># e.g., last_train_as_of_time = 2016-10-01 - 6month = 2016-04-01</span>
    <span class="n">training_prediction_delta</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span>
        <span class="n">training_label_timespan</span>
    <span class="p">)</span>
    <span class="n">last_train_as_of_time</span> <span class="o">=</span> <span class="n">train_test_split_time</span> <span class="o">-</span> <span class="n">training_prediction_delta</span>

    <span class="c1"># earliest time in matrix can&#39;t be farther back than the latest of the beginning</span>
    <span class="c1"># of label time or the beginning of feature time -- whichever is latest is the</span>
    <span class="c1"># limit if the amount of history we want to take would go further back.</span>
    <span class="c1">#</span>
    <span class="c1"># e.g., 2016-04-01 - 2year = 2014-04-01, which is later than both our</span>
    <span class="c1"># label_start_time (2012-01-01) and our feature_start_time (1995-01-01), so we</span>
    <span class="c1"># can use earliest_possible_train_as_of_time = 2014-04-01</span>
    <span class="n">max_training_delta</span> <span class="o">=</span> <span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">max_training_history</span><span class="p">)</span>
    <span class="n">earliest_possible_train_as_of_time</span> <span class="o">=</span> <span class="n">last_train_as_of_time</span> <span class="o">-</span> <span class="n">max_training_delta</span>
    <span class="n">experiment_as_of_time_limit</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_start_time</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">earliest_possible_train_as_of_time</span> <span class="o">&lt;</span> <span class="n">experiment_as_of_time_limit</span><span class="p">:</span>
        <span class="n">earliest_possible_train_as_of_time</span> <span class="o">=</span> <span class="n">experiment_as_of_time_limit</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Earliest possible train as of time: </span><span class="si">{</span><span class="n">earliest_possible_train_as_of_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># with the last as of time and the earliest possible time known,</span>
    <span class="c1"># calculate all the as of times for the matrix, stepping backwards</span>
    <span class="c1"># from the last as of time (to ensure that we use the latest possible</span>
    <span class="c1"># training data even if there&#39;s a gap and things don&#39;t line up</span>
    <span class="c1"># exactly) by the training_as_of_date_frequency</span>
    <span class="c1">#</span>
    <span class="c1"># for our example, this will give us a list of every day from 2014-04-01</span>
    <span class="c1"># through 2016-04-01, including _both_ endpoints</span>
    <span class="n">train_as_of_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_as_of_times</span><span class="p">(</span>
        <span class="n">as_of_start_limit</span><span class="o">=</span><span class="n">earliest_possible_train_as_of_time</span><span class="p">,</span>
        <span class="n">as_of_end_limit</span><span class="o">=</span><span class="n">last_train_as_of_time</span><span class="p">,</span>
        <span class="n">data_frequency</span><span class="o">=</span><span class="n">convert_str_to_relativedelta</span><span class="p">(</span><span class="n">training_as_of_date_frequency</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train as of times: </span><span class="si">{</span><span class="n">train_as_of_times</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># create a dict of the matrix metadata</span>
    <span class="n">matrix_definition</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;first_as_of_time&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">train_as_of_times</span><span class="p">),</span>
        <span class="s2">&quot;last_as_of_time&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_as_of_times</span><span class="p">),</span>
        <span class="s2">&quot;matrix_info_end_time&quot;</span><span class="p">:</span> <span class="n">train_test_split_time</span><span class="p">,</span>
        <span class="s2">&quot;as_of_times&quot;</span><span class="p">:</span> <span class="n">AsOfTimeList</span><span class="p">(</span><span class="n">train_as_of_times</span><span class="p">),</span>
        <span class="s2">&quot;training_label_timespan&quot;</span><span class="p">:</span> <span class="n">training_label_timespan</span><span class="p">,</span>
        <span class="s2">&quot;training_as_of_date_frequency&quot;</span><span class="p">:</span> <span class="n">training_as_of_date_frequency</span><span class="p">,</span>
        <span class="s2">&quot;max_training_history&quot;</span><span class="p">:</span> <span class="n">max_training_history</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">matrix_definition</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="triage.component.timechop.timechop.Timechop.generate_matrix_definitions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_matrix_definitions</span><span class="p">(</span><span class="n">train_test_split_time</span><span class="p">,</span> <span class="n">training_as_of_date_frequency</span><span class="p">,</span> <span class="n">max_training_history</span><span class="p">,</span> <span class="n">test_duration</span><span class="p">,</span> <span class="n">training_label_timespan</span><span class="p">,</span> <span class="n">test_label_timespan</span><span class="p">)</span></code>

<a href="#triage.component.timechop.timechop.Timechop.generate_matrix_definitions" class="headerlink" title="Permanent link">#</a></h5>


    <div class="doc doc-contents ">

        <p>Given a split time and parameters for train and test matrices,
generate as of times and metadata for the matrices in the split.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>train_test_split_time</code>
            </td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the limit of the last label in the matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>training_as_of_date_frequency</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how much time between rows for an entity
                            in a training matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_training_history</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how far back from split do train
                        as_of_times go</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_duration</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how far forward from split do test as_of_times go</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>training_label_timespan</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how much time covered by train labels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_label_timespan</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how much time is covered by test labels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary defining the train and test matrices for a split</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/triage/component/timechop/timechop.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_matrix_definitions</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">train_test_split_time</span><span class="p">,</span>
    <span class="n">training_as_of_date_frequency</span><span class="p">,</span>
    <span class="n">max_training_history</span><span class="p">,</span>
    <span class="n">test_duration</span><span class="p">,</span>
    <span class="n">training_label_timespan</span><span class="p">,</span>
    <span class="n">test_label_timespan</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given a split time and parameters for train and test matrices,</span>
<span class="sd">    generate as of times and metadata for the matrices in the split.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        train_test_split_time (datetime.datetime): the limit of the last label in the matrix</span>
<span class="sd">        training_as_of_date_frequency (str): how much time between rows for an entity</span>
<span class="sd">                                        in a training matrix</span>
<span class="sd">        max_training_history (str): how far back from split do train</span>
<span class="sd">                                    as_of_times go</span>
<span class="sd">        test_duration (str): how far forward from split do test as_of_times go</span>
<span class="sd">        training_label_timespan (str): how much time covered by train labels</span>
<span class="sd">        test_label_timespan (str): how much time is covered by test labels</span>

<span class="sd">    returns:</span>
<span class="sd">        dict: dictionary defining the train and test matrices for a split</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># continuing our example, let&#39;s consider the case when this is called for the last</span>
    <span class="c1"># train_test_split_time, so the parameters here are:</span>
    <span class="c1">#   train_test_split_time = 2016-10-01</span>
    <span class="c1">#   training_as_of_date_frequency = 1day</span>
    <span class="c1">#   max_training_history = 2year</span>
    <span class="c1">#   test_duration = 3month</span>
    <span class="c1">#   training_label_timespan = 6month</span>
    <span class="c1">#   test_label_timespan = 6month</span>

    <span class="c1"># for the example, the train matrix will contain as_of_dates for every day from</span>
    <span class="c1"># 2014-04-01 through 2016-04-01, including _both_ endpoints, providing a 6 month</span>
    <span class="c1"># buffer between the last as_of_time and the train-test split time for the last</span>
    <span class="c1"># set of labels (see comments in the method for details)</span>
    <span class="n">train_matrix_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_train_matrix</span><span class="p">(</span>
        <span class="n">train_test_split_time</span><span class="o">=</span><span class="n">train_test_split_time</span><span class="p">,</span>
        <span class="n">training_label_timespan</span><span class="o">=</span><span class="n">training_label_timespan</span><span class="p">,</span>
        <span class="n">max_training_history</span><span class="o">=</span><span class="n">max_training_history</span><span class="p">,</span>
        <span class="n">training_as_of_date_frequency</span><span class="o">=</span><span class="n">training_as_of_date_frequency</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># for the example, the test matrix will contain three as_of_dates:</span>
    <span class="c1">#   [2016-10-01, 2016-11-01, 2016-12-01]</span>
    <span class="c1"># since we start at the train_test_split_time (2016-10-01) and walk forward by</span>
    <span class="c1"># the test_as_of_date_frequency (1 month) until we&#39;ve exhausted the test_duration</span>
    <span class="c1"># (3 months), exclusive (see comments in the method for details)</span>
    <span class="n">test_matrix_definitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_test_matrices</span><span class="p">(</span>
        <span class="n">train_test_split_time</span><span class="o">=</span><span class="n">train_test_split_time</span><span class="p">,</span>
        <span class="n">test_duration</span><span class="o">=</span><span class="n">test_duration</span><span class="p">,</span>
        <span class="n">test_label_timespan</span><span class="o">=</span><span class="n">test_label_timespan</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">matrix_set_definition</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;feature_start_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_start_time</span><span class="p">,</span>
        <span class="s2">&quot;feature_end_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_end_time</span><span class="p">,</span>
        <span class="s2">&quot;label_start_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_start_time</span><span class="p">,</span>
        <span class="s2">&quot;label_end_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_end_time</span><span class="p">,</span>
        <span class="s2">&quot;train_matrix&quot;</span><span class="p">:</span> <span class="n">train_matrix_definition</span><span class="p">,</span>
        <span class="s2">&quot;test_matrices&quot;</span><span class="p">:</span> <span class="n">test_matrix_definitions</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">spam</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matrix definitions for train/test split </span><span class="si">{</span><span class="n">train_test_split_time</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">matrix_set_definition</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">matrix_set_definition</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h2 id="triage.component.timechop.timechop-functions">Functions<a href="#triage.component.timechop.timechop-functions" class="headerlink" title="Permanent link">#</a></h2>



  </div>

    </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/dssg/triage" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/datascifellows" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/company/center-for-data-science-and-public-policy-university-of-chicago" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../../../js/mermaid.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>