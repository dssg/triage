
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Documentation for Triage." name="description"/>
<link href="http://dssg.github.io/triage/dirtyduck/triage_intro/" rel="canonical"/>
<link href="../../assets/images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.3.0, mkdocs-material-7.0.6" name="generator"/>
<title>A deeper look into triage - Triage Documentation</title>
<link href="../../assets/stylesheets/main.2c0c5eaf.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.7fa14f5b.min.css" rel="stylesheet"/>
<meta content="#546d78" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Ubuntu";--md-code-font-family:"Ubuntu Mono"}</style>
<link href="../../triage_docs.css" rel="stylesheet"/>
</head>
<body data-md-color-accent="deep-orange" data-md-color-primary="blue-grey" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#triage">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Triage Documentation" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Triage Documentation">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 22a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-6v7L9.5 7.5 7 9V2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Triage Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              A deeper look into triage
            
          </span>
</div>
</div>
</div>
<div class="md-header__options">
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="http://github.com/dssg/triage" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    dssg/triage
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Triage Documentation" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Triage Documentation">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 22a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-6v7L9.5 7.5 7 9V2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12z"></path></svg>
</a>
    Triage Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="http://github.com/dssg/triage" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    dssg/triage
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
        Get started with your own project
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Get started with your own project" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Get started with your own project
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../quickstart/">
        Quickstart guide
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../triage_project_workflow/">
        Suggested workflow
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
        Dirty Duck Tutorial
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Dirty Duck Tutorial" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Dirty Duck Tutorial
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
        Welcome!
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../dirty_duckling/">
        Dirty duckling
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3">
        Case studies
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Case studies" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
          Case studies
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../problem_description/">
        Problem description
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../eis/">
        Early Warning System
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../inspections/">
        Resource prioritization
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" id="__nav_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_4">
        Triage
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Triage" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
          Triage
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          A deeper look into triage
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        A deeper look into triage
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#triage-interface">
    Triage interface
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#a-simple-triage-experiment">
    A simple triage experiment
  </a>
<nav aria-label="A simple triage experiment" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#a-brief-recap-of-machine-learning">
    A brief recap of Machine Learning
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cohorts-labels-event-dates-and-as-of-dates">
    Cohorts, labels, event dates and as of dates
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#experiment-configuration-file">
    Experiment configuration file
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#temporal-crossvalidation">
    Temporal crossvalidation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feature-generation">
    Feature generation
  </a>
<nav aria-label="Feature generation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#imputation">
    Imputation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feature-groups-strategies">
    Feature groups strategies
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#controlling-the-size-of-the-tables">
    Controlling the size of the tables
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-grid">
    The Grid
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#audition">
    Audition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#post-modeling">
    Post-modeling
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#final-cleaning">
    Final cleaning
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#where-to-go-from-here">
    Where to go from here...
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#footnotes">
    Footnotes
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" id="__nav_3_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_5">
        Are you curious about the setup?
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Are you curious about the setup?" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_5">
<span class="md-nav__icon md-icon"></span>
          Are you curious about the setup?
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../infrastructure/">
        Infrastructure
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../data_preparation/">
        Data preparation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../for_the_impatient/">
        Quick setup
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
        Triage documentation
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Triage documentation" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Triage documentation
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" id="__nav_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1">
        Experiment
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Experiment" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
          Experiment
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/experiment-config/">
        Experiment Configuration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/feature-testing/">
        Testing Feature Configuration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/running/">
        Running an Experiment
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_4" id="__nav_4_1_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_4">
        Upgrading an Experiment
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Upgrading an Experiment" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_4">
<span class="md-nav__icon md-icon"></span>
          Upgrading an Experiment
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/upgrade-to-v8/">
        v7 -&gt; v8
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/upgrade-to-v7/">
        v6 -&gt; v7
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/upgrade-to-v6/">
        v5 -&gt; v6
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/upgrade-to-v5/">
        v3/v4 -&gt; v5
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/temporal-validation/">
        Temporal Validation Deep Dive
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/cohort-labels/">
        Cohort and Label Deep Dive
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/prediction-ranking/">
        Prediction Ranking
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/features/">
        Feature Generation Recipe Book
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/algorithm/">
        Experiment Algorithm
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../experiments/architecture/">
        Experiment Architecture
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2">
        Model selection
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Model selection" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Model selection
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../audition/audition_intro/">
        Intro to Audition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../audition/model_selection/">
        Model Selection Concepts
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/audition/">
        API Reference
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3">
        Postmodeling
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Postmodeling" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          Postmodeling
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../postmodeling/">
        Using Postmodeling
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../postmodeling/postmodeling-config/">
        Postmodeling &amp; Crosstabs Configuration
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ml_governance/">
        Model governance
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../predictlist/">
        Predictlist
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../aws_batch/">
        Scaling up
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../db/">
        Database Provisioner
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_8" id="__nav_4_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_8">
        API Reference
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="API Reference" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_8">
<span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_8_1" id="__nav_4_8_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_8_1">
        Audition
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Audition" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_8_1">
<span class="md-nav__icon md-icon"></span>
          Audition
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/audition/auditioner/">
        Auditioner
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/audition/audition-config/">
        Audition Configuration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/audition/selection_rules/">
        Selection Rules
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/audition/database-dependencies/">
        Database Dependencies
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#triage-interface">
    Triage interface
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#a-simple-triage-experiment">
    A simple triage experiment
  </a>
<nav aria-label="A simple triage experiment" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#a-brief-recap-of-machine-learning">
    A brief recap of Machine Learning
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cohorts-labels-event-dates-and-as-of-dates">
    Cohorts, labels, event dates and as of dates
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#experiment-configuration-file">
    Experiment configuration file
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#temporal-crossvalidation">
    Temporal crossvalidation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feature-generation">
    Feature generation
  </a>
<nav aria-label="Feature generation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#imputation">
    Imputation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feature-groups-strategies">
    Feature groups strategies
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#controlling-the-size-of-the-tables">
    Controlling the size of the tables
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-grid">
    The Grid
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#audition">
    Audition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#post-modeling">
    Post-modeling
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#final-cleaning">
    Final cleaning
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#where-to-go-from-here">
    Where to go from here...
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#footnotes">
    Footnotes
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="http://github.com/dssg/triage/edit/master/docs/sources/dirtyduck/triage_intro.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="triage">Triage<a class="headerlink" href="#triage" title="Permanent link">#</a></h1>
<p>Predictive analytics projects require coordinating many tasks, such as
feature generation, classifier training, evaluation, and list
generation. Each of these tasks is complicated in its own right, but
it also needs to be combined with the other tasks throughout the
course of the project.</p>
<p>DSaPP built <code>triage</code> to facilitate the creation of supervised learning
models, in particular <em>binary</em> classification models with a strong
temporal component in the data.</p>
<p>The dataset's temporal component mainly affects two modeling steps:
<em>feature creation</em> (you need to be careful to avoid <em>leaking</em>
information from the future through your <em>features</em>) and
hyperparameter selection. <code>triage</code> solves both by splitting the data
into temporal blocks and automating temporal cross-validation (TCC)
and the feature generation.</p>
<p><code>triage</code> uses the concept of an <em>experiment</em>. An <em>experiment</em> consists
of a series of steps that aim to generate a good model for predicting
the <em>label</em> of an entity in the data set. The steps are <em>data
time-splitting</em>, <em>label generation</em>, <em>feature generation</em>, <em>matrix
creation</em>, <em>model training</em>, <em>predictions</em>, and <em>model evaluation</em>. In
each of these steps, <code>triage</code> will handle the temporal nuances of the
data.</p>
<p>Nowadays <code>triage</code> will help you to select the best model (<em>model
selection</em>) and it allows you to explore and understand the behavior
of your models using <strong>post-modeling</strong> techniques.</p>
<p>You need to specify (via a configuration file) how you want to split
your data temporally, which combination of machine learning algorithms
and their hyperparameters you'd like to use, which kinds of features
you want to generate, which subsets of those features you want to try
in each model, and which metrics you'd like to use to evaluate
performance and provide some criteria to select the best model.</p>
<p>An <strong>experiment run</strong> consists in fitting every combination of
algorithm, hyperparameters, and feature subsets to the temporally
split data and evaluating their predictive performance on future data
splits using the user's metrics.</p>
<p><code>triage</code> calls a unique combination of algorithm, hyperparameters, and
feature subsets a <code>model_group</code> and a model group fit to a specific
data matrix a <code>model</code>. Our data typically span multiple time periods,
so triage fits multiple models for each model group.</p>
<p><code>triage</code> is simple to use, but it contains a lot of complex concepts
that we will try to clarify in this section. First we will explain
<em>how</em> to run <code>triage</code>, and then we will create a toy experiment that  helps explain triage's main concepts.</p>
<h2 id="triage-interface">Triage interface<a class="headerlink" href="#triage-interface" title="Permanent link">#</a></h2>
<p>To run a <code>triage</code> experiment, you need the following:</p>
<ul>
<li>
<p>A database with the data that you want to model.</p>
<ul>
<li>In this tutorial, the credentials are part of the <code>DATABASE_URL</code> environment variable</li>
</ul>
</li>
<li>
<p><code>triage</code> installed in your environment. You can verify that <code>triage</code> is indeed installed if you type in <code>bastion</code>:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>triage -h
</code></pre></div>
<ul>
<li>An <em>experiment config file</em>. This is where the magic happens. We will discuss this file at length in this section of the tutorial.</li>
</ul>
<p>We are providing a <code>docker</code> container, <code>bastion</code>, that executes <code>triage</code> experiments. You already had the database (you were working on it the last two sections of this tutorial, remember?). So, like a real project, you just need to worry about the <em>experiment configuration file</em>.</p>
<p>In the following section of the tutorial we will use a small experiment configuration file located at &lt;../triage/experiments/simple_test_skeleton.yaml&gt;.</p>
<p>We will show you how to setup the experiment while explaining the inner workings of <code>triage</code>. We will modify the configuration file to show the effects of the configuration parameters. If you want to follow along, we suggest you copy that file and modify by yourself.</p>
<p>You can run that experiment with:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Remember to run this in bastion NOT in your laptop!</span>
triage experiment experiments/simple_test_skeleton.yaml
</code></pre></div>
<p>Every time you modify the configuration file and see the effects, you should execute the experiment again using the previous command.</p>
<h2 id="a-simple-triage-experiment">A simple <code>triage</code> experiment<a class="headerlink" href="#a-simple-triage-experiment" title="Permanent link">#</a></h2>
<h3 id="a-brief-recap-of-machine-learning">A brief recap of Machine Learning<a class="headerlink" href="#a-brief-recap-of-machine-learning" title="Permanent link">#</a></h3>
<p><strong>Triage</strong> helps you to run a <em>Machine learning</em> experiment. An experiment in this context means the use of Machine Learning to explore a dynamic system in order to do some predictions about it.</p>
<p>Before execute the <em>any</em> ML experiment, you need to define some <em>boundaries</em>:</p>
<ul>
<li>Which are the entities that you want to study?</li>
<li>What will you want to know about them?</li>
</ul>
<p>In DSaPP, we build ML systems that aim to have social impact, i.e. help government offices, NGOs or other agents to do their job better. "Do their job better" means increase their reach (e.g. identify correctly more entities with some characteristics) using more efficiently their (scarce) resources (e.g. inspectors, medics, money, etc).</p>
<p>With this optic, the <em>boundaries</em> are:</p>
<ul>
<li><strong>Cohort:</strong> Which are the entities that you want to reach?</li>
<li><strong>Label:</strong> What will you want to know about them?</li>
<li><strong>Label timespan:</strong> In what time period?</li>
<li><strong>Update frequency:</strong> How frequently do you want to intervene?</li>
<li><strong>List size:</strong> How many resources do you have to intervene?</li>
</ul>
<p>Triage's experiment configuration file structures this information.</p>
<h3 id="cohorts-labels-event-dates-and-as-of-dates">Cohorts, labels, event dates and as of dates<a class="headerlink" href="#cohorts-labels-event-dates-and-as-of-dates" title="Permanent link">#</a></h3>
<p>We will use the <em>inspections prioritization</em> as a narrative to help clarify these concepts:</p>
<ul>
<li>***Which are the entities that you want to reach?<em>:*</em> Active facilities, i.e. facilities that exists at the day of the <em>planning</em> inspections. We don't want to waste city resources (inspectors time) going to facilities that are out of business.</li>
<li><strong>What will you want to know about them?:</strong> Will those facilities fail the inspection?</li>
<li><strong>In what time period?:</strong> Will those facilities fail the inspection in the following month?</li>
<li><strong>How frequently do you want to intervene?:</strong> Every month.</li>
<li><strong>How many resources do you have to intervene?:</strong> We only have one inspector, so, one inspection per month</li>
</ul>
<p>To exemplify and explain the inner workings of <code>triage</code> in this scenario, we will use a subset of the <code>semantic.events</code> table with the following facilities (i.e. imagine that Chicago only has this three facilities):</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">license_num</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">facility_aka</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">facility_type</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">activity_period</span><span class="w"></span>
<span class="k">from</span><span class="w"></span>
<span class="w">    </span><span class="n">semantic</span><span class="p">.</span><span class="n">entities</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">license_num</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1596210</span><span class="p">,</span><span class="w"> </span><span class="mi">1874347</span><span class="p">,</span><span class="w"> </span><span class="mi">1142451</span><span class="p">)</span><span class="w"></span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="w"> </span><span class="k">asc</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<table>
<thead>
<tr>
<th>entity<sub>id</sub></th>
<th>license<sub>num</sub></th>
<th>facility<sub>aka</sub></th>
<th>facility<sub>type</sub></th>
<th>activity<sub>period</sub></th>
</tr>
</thead>
<tbody>
<tr>
<td>229</td>
<td>1596210</td>
<td>food 4 less</td>
<td>grocery store</td>
<td>[2010-01-08,)</td>
</tr>
<tr>
<td>355</td>
<td>1874347</td>
<td>mcdonalds</td>
<td>restaurant</td>
<td>[2010-01-12,2017-11-09)</td>
</tr>
<tr>
<td>840</td>
<td>1142451</td>
<td>jewel foodstore # 3345</td>
<td>grocery store</td>
<td>[2010-01-26,)</td>
</tr>
</tbody>
</table>
<p>The first thing <code>triage</code> does when executes the experiment, is split the time that the data covers in blocks considering the time horizon for the <em>label</em> ( <em>Which facilities will fail an inspection in the following month?</em> in this scenario of <strong>inspection prioritization<sup><a class="footref" href="#fn.1" id="fnr.1">1</a></sup></strong>) . This time horizon is calculated from a set of specific dates (<code>as_of_date</code> in triage parlance) that divide the blocks in past (for training the model) and future (for testing the model). The set of <code>as_of_dates</code> is (<em>mainly</em>) calculated from the <em>label timespan</em> and the <em>update frequency</em><sup><a class="footref" href="#fn.2" id="fnr.2">2</a></sup>. The <em>as of date</em> is not the <em>event date</em>. The <em>event date</em> occurred <em>when</em> the facility was inspected. The <em>as of date</em> is when the planning of the future facilities to be inspected happens.</p>
<p><code>triage</code> will create those <em>labels</em> using information about the <em>outcome</em> of the event<sup><a class="footref" href="#fn.3" id="fnr.3">3</a></sup>, taking into account the temporal structure of the data. In our example: if a facility is inspected is an event, and whether it fails the inspection (outcome <em>true</em>) or not (outcome <em>false</em>).</p>
<p>For a given entity on a given <em>as of date</em>, <code>triage</code> asks whether there's an outcome in the future time horizon. If so, <code>triage</code> will generate a <em>label</em> for that specific entity on that <em>as of date</em>.</p>
<p>For this example, the <em>label</em> will be if given an <em>as of date</em> (e.g. January first, 2014), the facility will have a failed inspection in the following year.</p>
<p>The following example hopefully will clarify the difference between <em>outcome</em> and <em>label</em>. We will focus on events (inspections) that happened in the year of 2014.</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"></span>
<span class="w">    </span><span class="nb">date</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'fail'</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">outcome</span><span class="w"></span>
<span class="k">from</span><span class="w"></span>
<span class="w">    </span><span class="n">semantic</span><span class="p">.</span><span class="n">events</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="s1">'[2014-01-01, 2015-01-01]'</span><span class="p">::</span><span class="n">daterange</span><span class="w"> </span><span class="o">@&gt;</span><span class="w"> </span><span class="nb">date</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">229</span><span class="p">,</span><span class="mi">355</span><span class="p">,</span><span class="mi">840</span><span class="p">)</span><span class="w"></span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"></span>
<span class="w">    </span><span class="nb">date</span><span class="w"> </span><span class="k">asc</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<table>
<thead>
<tr>
<th>date</th>
<th>entity<sub>id</sub></th>
<th>outcome</th>
</tr>
</thead>
<tbody>
<tr>
<td>2014-01-14</td>
<td>840</td>
<td>f</td>
</tr>
<tr>
<td>2014-02-04</td>
<td>229</td>
<td>f</td>
</tr>
<tr>
<td>2014-02-24</td>
<td>840</td>
<td>t</td>
</tr>
<tr>
<td>2014-03-05</td>
<td>840</td>
<td>f</td>
</tr>
<tr>
<td>2014-04-10</td>
<td>355</td>
<td>t</td>
</tr>
<tr>
<td>2014-04-15</td>
<td>229</td>
<td>f</td>
</tr>
<tr>
<td>2014-04-18</td>
<td>355</td>
<td>f</td>
</tr>
<tr>
<td>2014-05-06</td>
<td>840</td>
<td>f</td>
</tr>
<tr>
<td>2014-08-28</td>
<td>355</td>
<td>f</td>
</tr>
<tr>
<td>2014-09-19</td>
<td>229</td>
<td>f</td>
</tr>
<tr>
<td>2014-09-30</td>
<td>355</td>
<td>t</td>
</tr>
<tr>
<td>2014-10-10</td>
<td>355</td>
<td>f</td>
</tr>
<tr>
<td>2014-10-31</td>
<td>840</td>
<td>f</td>
</tr>
</tbody>
</table>
<p>We can observe that the facilities had several inspections, but in that timeframe <code>362</code> y <code>859</code> had failed inspections.</p>
<p>Continuing the narrative, from the perspective of the day of <code>2014-01-01</code> (<em>as of date</em>), those facilities will have positive <em>label</em>.</p>
<p>We can express that in a query and getting the <em>labels</em> for that <em>as of date</em> :</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"></span>
<span class="w">    </span><span class="s1">'2014-01-01'</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">as_of_date</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">bool_or</span><span class="p">(</span><span class="k">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'fail'</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">label</span><span class="w"></span>
<span class="k">from</span><span class="w"></span>
<span class="w">    </span><span class="n">semantic</span><span class="p">.</span><span class="n">events</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="s1">'2014-01-01'</span><span class="p">::</span><span class="k">timestamp</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">date</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">'2014-01-01'</span><span class="p">::</span><span class="k">timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="s1">'1 year'</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">229</span><span class="p">,</span><span class="mi">355</span><span class="p">,</span><span class="mi">840</span><span class="p">)</span><span class="w"></span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<table>
<thead>
<tr>
<th>as<sub>of</sub><sub>date</sub></th>
<th>entity<sub>id</sub></th>
<th>label</th>
</tr>
</thead>
<tbody>
<tr>
<td>2014-01-01</td>
<td>229</td>
<td>0</td>
</tr>
<tr>
<td>2014-01-01</td>
<td>355</td>
<td>1</td>
</tr>
<tr>
<td>2014-01-01</td>
<td>840</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Note that ee transform the <em>label</em> to integer, since the machine learning algorithms only work with numeric data.</p>
<p>We also need a way to store the <em>state</em> of each entity. We can group entities in <em>cohorts</em> defined by the state. The <em>cohort</em> can be used to decide which facilities you want to predict on (i.e. include in the ML train/test matrices). The rationale of this comes from the need to only predict for entities in a particular state: <em>Is the restaurant new?</em> <em>Is this facility on this zip code</em>? <em>Is the facility "active"?</em><sup><a class="footref" href="#fn.4" id="fnr.4">4</a></sup></p>
<p>We will consider a facility as <strong>active</strong> if a given <em>as of date</em> is in the interval defined by the <code>start_date</code> and <code>end_date</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"></span>
<span class="w">    </span><span class="s1">'2018-01-01'</span><span class="p">::</span><span class="nb">date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">as_of_date</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">activity_period</span><span class="p">,</span><span class="w"></span>
<span class="k">case</span><span class="w"> </span><span class="k">when</span><span class="w"></span>
<span class="n">activity_period</span><span class="w"> </span><span class="o">@&gt;</span><span class="w"> </span><span class="s1">'2018-01-01'</span><span class="p">::</span><span class="nb">date</span><span class="w"> </span><span class="c1">-- 2018-01-01 is as of date</span>
<span class="k">then</span><span class="w"> </span><span class="s1">'active'</span><span class="p">::</span><span class="nb">text</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="s1">'inactive'</span><span class="p">::</span><span class="nb">text</span><span class="w"></span>
<span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">state</span><span class="w"></span>
<span class="k">from</span><span class="w"></span>
<span class="w">    </span><span class="n">semantic</span><span class="p">.</span><span class="n">entities</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">229</span><span class="p">,</span><span class="mi">355</span><span class="p">,</span><span class="mi">840</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<table>
<thead>
<tr>
<th>as<sub>of</sub><sub>date</sub></th>
<th>entity<sub>id</sub></th>
<th>activity<sub>period</sub></th>
<th>state</th>
</tr>
</thead>
<tbody>
<tr>
<td>2018-01-01</td>
<td>229</td>
<td>[2010-01-08,)</td>
<td>active</td>
</tr>
<tr>
<td>2018-01-01</td>
<td>355</td>
<td>[2010-01-12,2017-11-09)</td>
<td>inactive</td>
</tr>
<tr>
<td>2018-01-01</td>
<td>840</td>
<td>[2010-01-26,)</td>
<td>active</td>
</tr>
</tbody>
</table>
<p><code>Triage</code> will use a simple modification of the queries that we just discussed for automate the generation of the <em>cohorts</em> and <em>labels</em> for our experiment.</p>
<h2 id="experiment-configuration-file">Experiment configuration file<a class="headerlink" href="#experiment-configuration-file" title="Permanent link">#</a></h2>
<p>The <em>experiment configuration file</em> is used to create the <code>experiment</code> object. Here, you will specify the temporal configuration, the features to be generated, the labels to learn, and the models that you want to train in your data.</p>
<p>The configuration file is a <code>yaml</code> file with the following main sections:</p>
<ul>
<li>
<p><strong><a href="#orgecc6227"><code>temporal_config</code></a>:</strong> Temporal specification of the data, used for creating the blocks for temporal crossvalidation.</p>
</li>
<li>
<p><strong><code>cohort_config</code>:</strong> Using the state of the entities, define (using <code>sql</code>) <em>cohorts</em> to filter out objects that shouldn't be included in the training and prediction stages. This will generate a table call <code>cohort_{experiment_hash}</code></p>
</li>
<li>
<p><strong><code>label_config</code>:</strong> Specify (using <code>sql</code>) how to generate <em>labels</em> from the event's <em>outcome</em>. A table named <code>labels_{experiment_hash}</code> will be created.</p>
</li>
<li>
<p><strong><a href="#orga9dbe41"><code>feature_aggregation</code></a>:</strong> Which spatio-temporal aggregations of the columns in the data set do you want to generate as features for the models?</p>
</li>
<li>
<p><strong><code>model_group_keys</code>:</strong> How do you want to identify the <code>model_group</code> in the database (so you can run analysis on them)?</p>
</li>
<li>
<p><strong><a href="#org91afffc"><code>grid_config</code></a>:</strong> Which combination of hyperparameters and algorithms will be trained and evaluated in the data set?</p>
</li>
<li>
<p><strong><code>scoring</code>:</strong> Which metrics will be calculated?</p>
</li>
</ul>
<p>Two of the more important (and potentially confusing) sections are <code>temporal_config</code> and <code>feature_generation</code>. We will explain them in detail in the next sections.</p>
<p><a id="orgecc6227"></a></p>
<h2 id="temporal-crossvalidation">Temporal crossvalidation<a class="headerlink" href="#temporal-crossvalidation" title="Permanent link">#</a></h2>
<p>Cross validation is a common technique to select a model that
generalizes well to new data. Standard cross validation randomly
splits the training data into subsets, fits models on all but one, and
calculates the metric of interest (e.g. precision/recall) on the one
left out, rotating through the subsets and leaving each out once. You
select the model that performed best across the left-out sets, and
then retrain it on the complete training data.</p>
<p>Unfortunately, standard cross validation is inappropriate for most
real-world data science problems. If your data have temporal
correlations, standard cross validation lets the model peek into the
future, training on some future observations and testing on past
observations. To avoid this problem, you should design your training
and testing to mimic how your model will be used, making predictions
only using the data that would be available at that time (i.e. from
the past).</p>
<p>In temporal crossvalidation, rather than randomly splitting the
dataset into training and test splits, temporal cross validation
splits the data by time.</p>
<p><code>triage</code> uses the <code>timechop</code> library for this purpose. <code>Timechop</code> will
"chop" the data set in several temporal blocks. These blocks are then
used for creating the features and matrices for training and
evaluation of the machine learning models.</p>
<p>Assume we want to select which restaurant (of two in our example
dataset) we should inspect next year based on its higher risk of
violating some condition. Also assume that the process of picking
which facility is repeated every year on January 1<sup>st</sup><sup><a class="footref" href="#fn.5" id="fnr.5">5</a></sup></p>
<p>Following the problem description template given in Section
<strong>Description of the problem to solve</strong>, the question that we'll
attempt to answer is:</p>
<blockquote>
<p>Which facility ( <span><span class="MathJax_Preview">n=1</span><script type="math/tex">n=1</script></span> ) is likely to violate some inspected condition in the following year ( <span><span class="MathJax_Preview">X=1</span><script type="math/tex">X=1</script></span> )?</p>
</blockquote>
<p>The traditional approach in machine learning is splitting the data in
training and test datasets. Train or fit the algorithm on the training
data set to generate a train model and test or evaluate the model on
the test data set. We will do the same here, but, with the help of
<code>timechop</code> we will take in account the time:</p>
<p>We will fit models on training set up to 2014-01-01 and see how well
those models would have predicted 2015; fit more models on training
set up to 2015-01-01 and see how well those models would have
predicted 2016; and so on. That way, we choose models that have
historically performed best at our task, forecasting. Itâ€™s why this
approach is sometimes called <em>evaluation on a rolling forecast origin</em>
because the origin at which the prediction is made rolls forward in
time. <sup><a class="footref" href="#fn.6" id="fnr.6">6</a></sup></p>
<p><img alt="img" src="../images/rolling-origin.png" title="Cartoonish view of temporal splitting for Machine Learning, each point represents an *as of date*, the orange area are the past of that *as of date* and is used for feature generation. The blue area is the label span, it lies in the future of the *as of date*."/></p>
<p>The data at which the model will do the predictions is denominated as
<em>as of date</em> in <code>triage</code> (<em>as of date</em> = January first in our
example). The length of the prediction time window (1 year) is called
<em>label span</em>. Training and predicting with a new model <em>as of date</em>
(every year) is the <em>model update frequency</em>.</p>
<p>Because it's inefficient to calculate by hand all the <em>as of dates</em> or
prediction points, <code>timechop</code> will take care of that for us. To do so,
we need to specify some more constraints besides the <em>label span</em>  and the <em>model update frequency</em>:</p>
<ul>
<li>What is the date range covered by our data?</li>
<li>What is the date range in which we have information about labels?</li>
<li>How frequently do you receive information about your entities?</li>
<li>How far in the future you want to predict?</li>
<li>How much of the past data do you want to use?</li>
</ul>
<p>With this information, <code>timechop</code> will calculate as-of train and test
dates from the last date in which you have label data, using the label
span in both test and train sets, plus the constraints just
mentioned.</p>
<p>In total <code>timechop</code> uses 11 configuration parameters<sup><a class="footref" href="#fn.7" id="fnr.7">7</a></sup>.</p>
<ul>
<li>
<p>There are parameters related to the boundaries of the available data set:</p>
<ul>
<li><strong><code>feature_start_time</code>:</strong> data aggregated into features begins at this point (earliest date included in features)</li>
<li><strong><code>feature_end_time</code>:</strong> data aggregated into features is from before this point (latest date included in features)</li>
<li><strong><code>label_start_time</code>:</strong> data aggregated into labels begins at this point (earliest event date included in any label (event date &gt;= label<sub>start</sub><sub>time</sub>)</li>
<li><strong><code>label_end_time</code>:</strong> data aggregated is from before this point (event date &lt; label<sub>end</sub><sub>time</sub> to be included in any label)</li>
</ul>
</li>
<li>
<p>Parameters that control the <em>labels</em>' time horizon on the train and test sets:</p>
<ul>
<li>
<p><strong><code>training_label_timespans</code>:</strong> how much time is covered by training labels (e.g., outcomes in the next 3 days? 2 months? 1 year?) (training prediction span)</p>
</li>
<li>
<p><strong><code>test_label_timespans</code>:</strong> how much time is covered by test prediction (e.g., outcomes in the next 3 days? 2 months? 1 year?) (test prediction span)</p>
</li>
</ul>
<p>These parameters will be used with the <em>outcomes</em> table to
generate the <em>labels</em>. In an <strong>early warning</strong> setting, they will
often have the same value. For <strong>inspections prioritization</strong>,
this value typically equals <code>test_durations</code> and
<code>model_update_frequency</code>.</p>
</li>
<li>
<p>Parameters related about how much data we want to use, both in the future and in the past relative to the <em>as-of date</em>:</p>
<ul>
<li>
<p><strong><code>test_durations</code>:</strong> how far into the future should a model be used to make predictions (test span)</p>
<p><strong>NOTE</strong>: in the typical case of wanting a single prediction set immediately after model training, this should be set to 0 days</p>
</li>
</ul>
<p>For early warning problems, <code>test_durations</code> should equal
<code>model_update_frequency</code>. For inspection prioritization,
organizational process determines the value: <em>how far out are you
scheduling for?</em></p>
<p>The equivalent of <code>test_durations</code> for the training matrices is <code>max_training_histories</code>:</p>
<ul>
<li><strong><code>max_training_histories</code>:</strong> the maximum amount of history
    for each entity to train on (early matrices may contain less
    than this time if it goes past label/feature start times). If
    patterns have changed significantly, models trained on recent
    data may outperform models trained on a much lengthier
    history.</li>
</ul>
</li>
<li>
<p>Finally, we should specify how many rows per <code>entity_id</code> in the train and test matrix:</p>
<ul>
<li>
<p><strong><code>training_as_of_date_frequencies</code>:</strong> how much time between
    rows for a single entity in a training matrix (list time
    between rows for same entity in train matrix).</p>
</li>
<li>
<p><strong><code>test_as_of_date_frequencies</code>:</strong> how much time between rows
    for a single entity in a test matrix (time between rows for
    same entity in test matrix).</p>
</li>
</ul>
</li>
</ul>
<p>The following images (we will show how to generate them later) shows
the time blocks created by several temporal configurations. We will
change a parameter at a time so you could see how it affects the  resulting blocks.</p>
<p>If you want to try the modifications (or your own) and generate the
temporal blocks images run the following (they'll be generated in
&lt;./images/&gt;):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Remember to run this in bastion NOT in laptop's shell!</span>
triage experiment experiments/simple_test_skeleton.yaml --show-timechop
</code></pre></div>
<ul>
<li>
<p><code>{feature, label}_{end, start}_time</code></p>
<p>The image below shows these <code>{feature, label}_start_time</code> are
equal, as are the <code>{feature, label}_end_time</code>. These parameters
show in the image as dashed vertical black lines. This setup will
be our <strong>baseline</strong> example.</p>
<p>The plot is divided in two horizontal lines ("Block 0" and "Block
1"). Each line is divided by vertical dashed lines â€“ the
grey lines outline the boundaries of the data for features and
data for labels, which in this image coincide. The black dash
lines represent the beginning and the end of the test set. In
"Block 0" those lines correspond to <code>2017</code> and <code>2018</code>, and in
"Block 1" they correspond to <code>2016</code> and <code>2017</code>.</p>
<p><img alt="img" src="../images/timechop/timechop_1.png" title="feature and label start, end time equal"/></p>
<p>The shaded areas (in this image there is just one per block, but
you will see other examples below) represents the span of the <em>as
of dates</em>. They start with the oldest <em>as of date</em> and end with
the latest. Each line inside that area represents the label
span. Those lines begin at the <em>as of date</em>. At each <em>as of date</em>,
timechop generates each entity's features (from the past) and
labels (from the future). So in the image, we will have two sets
of train/test datasets. Each facility will have 13 rows in "Block
0" and 12 rows in "Block 1". The trained models will predict the
label using the features calculated for that test set <em>as of
date</em>. The single line represents the label's time horizon in
testing.</p>
<p>This is the temporal configuration that generated the previous image:</p>
<div class="highlight"><pre><span></span><code><span class="nt">temporal_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-02'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>

<span class="w">    </span><span class="nt">model_update_frequency</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">test_durations</span><span class="p">:</span><span class="w"> </span><span class="s">'0d'</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">max_training_histories</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
</code></pre></div>
<p>In that configuration the date ranges of features and labels are
equal, but they can be different (maybe you have more data for
features that data for labels) as is shown in the following image
and in their configuration parameters.</p>
<p><img alt="img" src="../images/timechop/timechop_2.png" title="feature&lt;sub&gt;start&lt;/sub&gt;&lt;sub&gt;time&lt;/sub&gt; different different that label&lt;sub&gt;start&lt;/sub&gt;&lt;sub&gt;time&lt;/sub&gt;."/></p>
<div class="highlight"><pre><span></span><code><span class="nt">temporal_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2010-01-01'</span><span class="w">   </span><span class="c1"># &lt;------- The change happened here!</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-02'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>

<span class="w">    </span><span class="nt">model_update_frequency</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">test_durations</span><span class="p">:</span><span class="w"> </span><span class="s">'0d'</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">max_training_histories</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
</code></pre></div>
</li>
<li>
<p><code>model_update_frequency</code></p>
<p>From our <strong>baseline</strong> <code>temporal_config</code> example
(<a href="#org5f54d1f">102</a>), we will change how often we want a new
model, which generates more time blocks (if there are
time-constrained data, obviously).</p>
<div class="highlight"><pre><span></span><code><span class="nt">temporal_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-02'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>

<span class="w">    </span><span class="nt">model_update_frequency</span><span class="p">:</span><span class="w"> </span><span class="s">'6month'</span><span class="w"> </span><span class="c1"># &lt;------- The change happened here!</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">test_durations</span><span class="p">:</span><span class="w"> </span><span class="s">'0d'</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">max_training_histories</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
</code></pre></div>
<p><img alt="img" src="../images/timechop/timechop_3.png" title="A smaller model&lt;sub&gt;update&lt;/sub&gt;&lt;sub&gt;frequency&lt;/sub&gt; (from 1y to 6month) (The number of blocks grew)"/></p>
</li>
<li>
<p><code>max_training_histories</code></p>
<p>With this parameter you could get a <em>growing window</em> for training (depicted in <a href="#orgc3fbafd">110</a>) or as in all the other examples, <em>fixed training windows</em>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">temporal_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-02'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>

<span class="w">    </span><span class="nt">model_update_frequency</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">test_durations</span><span class="p">:</span><span class="w"> </span><span class="s">'0d'</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">max_training_histories</span><span class="p">:</span><span class="w"> </span><span class="s">'10y'</span><span class="w">  </span><span class="c1"># &lt;------- The change happened here!</span><span class="w"></span>
</code></pre></div>
<p><img alt="img" src="../images/timechop/timechop_4.png" title="The size of the block is bigger now"/></p>
</li>
<li>
<p><code>_as_of_date_frequencies</code> and <code>test_durations</code></p>
<div class="highlight"><pre><span></span><code><span class="nt">temporal_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-02'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>

<span class="w">    </span><span class="nt">model_update_frequency</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'3month'</span><span class="w"> </span><span class="c1"># &lt;------- The change happened here!</span><span class="w"></span>

<span class="w">    </span><span class="nt">test_durations</span><span class="p">:</span><span class="w"> </span><span class="s">'0d'</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">max_training_histories</span><span class="p">:</span><span class="w"> </span><span class="s">'10y'</span><span class="w"></span>
</code></pre></div>
<p><img alt="img" src="../images/timechop/timechop_5.png" title="Less rows per entity in the training block"/></p>
<p>Now, change <code>test_as_of_date_frequencies</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">temporal_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-02'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>

<span class="w">    </span><span class="nt">model_update_frequency</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">test_durations</span><span class="p">:</span><span class="w"> </span><span class="s">'0d'</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'3month'</span><span class="l l-Scalar l-Scalar-Plain">&lt;------- The change happened here!</span><span class="w"></span>

<span class="w">    </span><span class="nt">max_training_histories</span><span class="p">:</span><span class="w"> </span><span class="s">'10y'</span><span class="w"></span>
</code></pre></div>
<p><img alt="img" src="../images/timechop/timechop_6.png" title="We should get more rows per entity in the test matrix, but that didn't happen. Why?"/></p>
<p>Nothing changed because the test set doesn't have "space" to allow more spans. The "space" is controlled by <code>test_durations</code>, so let's change it to <code>6month</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">temporal_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-02'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>

<span class="w">    </span><span class="nt">model_update_frequency</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">test_durations</span><span class="p">:</span><span class="w"> </span><span class="s">'6month'</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;------- The change happened here!</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">max_training_histories</span><span class="p">:</span><span class="w"> </span><span class="s">'10y'</span><span class="w"></span>
</code></pre></div>
<p><img alt="img" src="../images/timechop/timechop_7.png" title='The test duration is bigger now, so we got 6 rows (since the "base" frequency is 1 month)'/></p>
<p>So, now we will move both parameters: <code>test_durations</code>, <code>test_as_of_date_frequencies</code></p>
<div class="highlight"><pre><span></span><code><span class="nt">temporal_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-02'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>

<span class="w">    </span><span class="nt">model_update_frequency</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">test_durations</span><span class="p">:</span><span class="w"> </span><span class="s">'6month'</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;------- The change happened here!</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'3month'</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;------- and also here!</span><span class="w"></span>

<span class="w">    </span><span class="nt">max_training_histories</span><span class="p">:</span><span class="w"> </span><span class="s">'10y'</span><span class="w"></span>
</code></pre></div>
<p><img alt="img" src="../images/timechop/timechop_8.png" title="With more room in testing, now test&lt;sub&gt;as&lt;/sub&gt;&lt;sub&gt;of&lt;/sub&gt;&lt;sub&gt;date&lt;/sub&gt;&lt;sub&gt;frequencies&lt;/sub&gt; has some effect."/></p>
</li>
<li>
<p><code>_label_timespans</code></p>
<div class="highlight"><pre><span></span><code><span class="nt">temporal_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-02'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>

<span class="w">    </span><span class="nt">model_update_frequency</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">test_durations</span><span class="p">:</span><span class="w"> </span><span class="s">'0d'</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'3month'</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">&lt;------- The change happened here!</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">max_training_histories</span><span class="p">:</span><span class="w"> </span><span class="s">'10y'</span><span class="w"></span>
</code></pre></div>
<p><img alt="img" src="../images/timechop/timechop_9.png" title="The label time horizon in the test dataset now is smaller"/></p>
<div class="highlight"><pre><span></span><code><span class="nt">temporal_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2014-01-02'</span><span class="w"></span>
<span class="w">    </span><span class="nt">label_end_time</span><span class="p">:</span><span class="w"> </span><span class="s">'2018-01-01'</span><span class="w"></span>

<span class="w">    </span><span class="nt">model_update_frequency</span><span class="p">:</span><span class="w"> </span><span class="s">'1y'</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'3month'</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;------- The change happened here!</span><span class="w"></span>
<span class="w">    </span><span class="nt">training_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">test_durations</span><span class="p">:</span><span class="w"> </span><span class="s">'0d'</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_label_timespans</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1y'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_as_of_date_frequencies</span><span class="p">:</span><span class="w"> </span><span class="s">'1month'</span><span class="w"></span>

<span class="w">    </span><span class="nt">max_training_histories</span><span class="p">:</span><span class="w"> </span><span class="s">'10y'</span><span class="w"></span>
</code></pre></div>
<p><img alt="img" src="../images/timechop/timechop_10.png" title="The label time horizon is smaller in the trainning dataset. One effect is that now we have more room for more rows per entity."/></p>
<p>That's it! Now you have the power to bend time!<sup><a class="footref" href="#fn.8" id="fnr.8">8</a></sup></p>
<p>With the time blocks defined, <code>triage</code> will create the <em>labels</em> and then the features for our train and test sets. We will discuss <em>features</em> in the following section.</p>
</li>
</ul>
<p><a id="orga9dbe41"></a></p>
<h2 id="feature-generation">Feature generation<a class="headerlink" href="#feature-generation" title="Permanent link">#</a></h2>
<p>We will show how to create features using the <em>experiments config
file</em>. <code>triage</code> uses <code>collate</code> for this.<sup><a class="footref" href="#fn.9" id="fnr.9">9</a></sup> The <code>collate</code> library
controls the generation of features (including the imputation rules
for each feature generated) using the time blocks generated by
<code>timechop</code>. <code>Collate</code> helps the modeler create features based on
<em>spatio-temporal aggregations</em> into the <em>as of date</em>. <code>Collate</code>
generates <code>SQL</code> queries that will create <em>features</em> per each <em>as of
date</em>.</p>
<p>As before, we will try to mimic what <code>triage</code> does behind the
scenario. <code>Collate</code> will help you to create features based on the
following template:</p>
<blockquote>
<p>For a given <em>as of date</em>, how the <em>aggregation function</em> operates
into a column taking into account a previous <em>time interval</em> and
some <em>attributes</em>.</p>
</blockquote>
<p>Two possible features could be framed as:</p>
<div class="highlight"><pre><span></span><code>As of 2016-01-01, how many inspections
has each facility had in the previous 6 months?
</code></pre></div>
<p>and</p>
<div class="highlight"><pre><span></span><code>As of 2016-01-01, how many "high risk" findings has the
facility had in the previous 6 months?
</code></pre></div>
<p>In our data, that date range (between 2016-01-01 and 2015-07-01) looks like:</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"></span>
<span class="w">    </span><span class="n">event_id</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nb">date</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">risk</span><span class="w"></span>
<span class="k">from</span><span class="w"></span>
<span class="w">    </span><span class="n">semantic</span><span class="p">.</span><span class="n">events</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="nb">date</span><span class="w"> </span><span class="o">&lt;@</span><span class="w"> </span><span class="n">daterange</span><span class="p">((</span><span class="s1">'2016-01-01'</span><span class="p">::</span><span class="nb">date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="s1">'6 months'</span><span class="p">)::</span><span class="nb">date</span><span class="p">,</span><span class="w"> </span><span class="s1">'2016-01-01'</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">229</span><span class="p">,</span><span class="mi">355</span><span class="p">,</span><span class="mi">840</span><span class="p">)</span><span class="w"></span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"></span>
<span class="w">    </span><span class="nb">date</span><span class="w"> </span><span class="k">asc</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<table>
<thead>
<tr>
<th>event<sub>id</sub></th>
<th>date</th>
<th>entity<sub>id</sub></th>
<th>risk</th>
</tr>
</thead>
<tbody>
<tr>
<td>1561324</td>
<td>2015-07-17</td>
<td>840</td>
<td>high</td>
</tr>
<tr>
<td>1561517</td>
<td>2015-07-24</td>
<td>840</td>
<td>high</td>
</tr>
<tr>
<td>1562122</td>
<td>2015-08-12</td>
<td>840</td>
<td>high</td>
</tr>
<tr>
<td>1547403</td>
<td>2015-08-20</td>
<td>229</td>
<td>high</td>
</tr>
<tr>
<td>1547420</td>
<td>2015-08-28</td>
<td>229</td>
<td>high</td>
</tr>
<tr>
<td>1547448</td>
<td>2015-09-14</td>
<td>355</td>
<td>medium</td>
</tr>
<tr>
<td>1547462</td>
<td>2015-09-21</td>
<td>355</td>
<td>medium</td>
</tr>
<tr>
<td>1547504</td>
<td>2015-10-09</td>
<td>355</td>
<td>medium</td>
</tr>
<tr>
<td>1547515</td>
<td>2015-10-16</td>
<td>355</td>
<td>medium</td>
</tr>
<tr>
<td>1583249</td>
<td>2015-10-21</td>
<td>840</td>
<td>high</td>
</tr>
<tr>
<td>1583577</td>
<td>2015-10-28</td>
<td>840</td>
<td>high</td>
</tr>
<tr>
<td>1583932</td>
<td>2015-11-04</td>
<td>840</td>
<td>high</td>
</tr>
</tbody>
</table>
<p>We can transform those data to two features: <code>number_of_inspections</code> and <code>flagged_as_high_risk</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s1">'2016-01-01'</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">as_of_date</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="n">event_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">inspections</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="n">event_id</span><span class="p">)</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="k">where</span><span class="w"> </span><span class="n">risk</span><span class="o">=</span><span class="s1">'high'</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">flagged_as_high_risk</span><span class="w"></span>
<span class="k">from</span><span class="w"></span>
<span class="w">    </span><span class="n">semantic</span><span class="p">.</span><span class="n">events</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="nb">date</span><span class="w"> </span><span class="o">&lt;@</span><span class="w"> </span><span class="n">daterange</span><span class="p">((</span><span class="s1">'2016-01-01'</span><span class="p">::</span><span class="nb">date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="s1">'6 months'</span><span class="p">)::</span><span class="nb">date</span><span class="p">,</span><span class="w"> </span><span class="s1">'2016-01-01'</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">229</span><span class="p">,</span><span class="mi">355</span><span class="p">,</span><span class="mi">840</span><span class="p">)</span><span class="w"></span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"></span>
<span class="w">    </span><span class="k">grouping</span><span class="w"> </span><span class="k">sets</span><span class="p">(</span><span class="n">entity_id</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<table>
<thead>
<tr>
<th>entity<sub>id</sub></th>
<th>as<sub>of</sub><sub>date</sub></th>
<th>inspections</th>
<th>flagged<sub>as</sub><sub>high</sub><sub>risk</sub></th>
</tr>
</thead>
<tbody>
<tr>
<td>229</td>
<td>2016-01-01</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>355</td>
<td>2016-01-01</td>
<td>4</td>
<td>0</td>
</tr>
<tr>
<td>840</td>
<td>2016-01-01</td>
<td>6</td>
<td>6</td>
</tr>
</tbody>
</table>
<p>This query is making an <em>aggregation</em>. Note that the previous <code>SQL</code> query has five parts:</p>
<ul>
<li>The <em>filter</em> ((<code>risk = 'high')::int</code>)</li>
<li>The <em>aggregation function</em> (<code>count()</code>)</li>
<li>The <em>name</em> of the resulting transformation (<code>flagged_as_high_risk</code>)</li>
<li>The <em>context</em> in which it is aggregated (by <code>entity_id</code>)</li>
<li>The <em>date range</em> (between 2016-01-01 and 6 months before)</li>
</ul>
<p>What about if we want to add proportions and totals of failed and passed inspections?</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"></span>
<span class="w">    </span><span class="n">entity_id</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s1">'2016-01-01'</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">as_of_date</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="n">event_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">inspections</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="n">event_id</span><span class="p">)</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="k">where</span><span class="w"> </span><span class="n">risk</span><span class="o">=</span><span class="s1">'high'</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">flagged_as_high_risk</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="n">event_id</span><span class="p">)</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="k">where</span><span class="w"> </span><span class="k">result</span><span class="o">=</span><span class="s1">'pass'</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">passed_inspections</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">round</span><span class="p">(</span><span class="k">avg</span><span class="p">((</span><span class="k">result</span><span class="o">=</span><span class="s1">'pass'</span><span class="p">)::</span><span class="nb">int</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">proportion_of_passed_inspections</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="n">event_id</span><span class="p">)</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="k">where</span><span class="w"> </span><span class="k">result</span><span class="o">=</span><span class="s1">'fail'</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">failed_inspections</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">round</span><span class="p">(</span><span class="k">avg</span><span class="p">((</span><span class="k">result</span><span class="o">=</span><span class="s1">'fail'</span><span class="p">)::</span><span class="nb">int</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">proportion_of_failed_inspections</span><span class="w"></span>
<span class="k">from</span><span class="w"></span>
<span class="w">    </span><span class="n">semantic</span><span class="p">.</span><span class="n">events</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="nb">date</span><span class="w"> </span><span class="o">&lt;@</span><span class="w"> </span><span class="n">daterange</span><span class="p">((</span><span class="s1">'2016-01-01'</span><span class="p">::</span><span class="nb">date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="s1">'6 months'</span><span class="p">)::</span><span class="nb">date</span><span class="p">,</span><span class="w"> </span><span class="s1">'2016-01-01'</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">229</span><span class="p">,</span><span class="mi">355</span><span class="p">,</span><span class="mi">840</span><span class="p">)</span><span class="w"></span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"></span>
<span class="w">    </span><span class="k">grouping</span><span class="w"> </span><span class="k">sets</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<table>
<thead>
<tr>
<th>entity<sub>id</sub></th>
<th>as<sub>of</sub><sub>date</sub></th>
<th>inspections</th>
<th>flagged<sub>as</sub><sub>high</sub><sub>risk</sub></th>
<th>passed<sub>inspections</sub></th>
<th>proportion<sub>of</sub><sub>passed</sub><sub>inspections</sub></th>
<th>failed<sub>inspections</sub></th>
<th>proportion<sub>of</sub><sub>failed</sub><sub>inspections</sub></th>
</tr>
</thead>
<tbody>
<tr>
<td>229</td>
<td>2016-01-01</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>0.50</td>
<td>1</td>
<td>0.50</td>
</tr>
<tr>
<td>355</td>
<td>2016-01-01</td>
<td>4</td>
<td>0</td>
<td>1</td>
<td>0.25</td>
<td>2</td>
<td>0.50</td>
</tr>
<tr>
<td>840</td>
<td>2016-01-01</td>
<td>6</td>
<td>6</td>
<td>4</td>
<td>0.67</td>
<td>2</td>
<td>0.33</td>
</tr>
</tbody>
</table>
<p>But what if we want to also add features for "medium" and "low" risk? And what would the query look like if we want to use several time intervals, like <em>3 months</em>, <em>5 years</em>, etc? What if we want to contextualize this by location? Plus we need to calculate all these features for several <em>as of dates</em> and manage the imputation strategy for all of them!!!</p>
<p>You will realize that even with this simple set of features we will require very complex <code>SQL</code> to be constructed.</p>
<p>But fear not. <code>triage</code> will automate that for us!</p>
<p>The following blocks of code represent a snippet of <code>triage</code>'s configuration file related to feature aggregation. It shows the <code>triage</code> syntax for the <code>inspections</code> feature constructed above:</p>
<div class="highlight"><pre><span></span><code><span class="nt">feature_aggregations</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"></span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">'inspections'</span><span class="w"></span>
<span class="w">    </span><span class="nt">from_obj</span><span class="p">:</span><span class="w"> </span><span class="s">'semantic.events'</span><span class="w"></span>
<span class="w">    </span><span class="nt">knowledge_date_column</span><span class="p">:</span><span class="w"> </span><span class="s">'date'</span><span class="w"></span>

<span class="w">    </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"></span>
<span class="w">        </span><span class="nt">quantity</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">total</span><span class="p">:</span><span class="w"> </span><span class="s">"*"</span><span class="w"></span>
<span class="w">        </span><span class="nt">imputation</span><span class="p">:</span><span class="w"></span>
<span class="w">           </span><span class="nt">count</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">'zero_noflag'</span><span class="w"></span>
<span class="w">        </span><span class="nt">metrics</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'count'</span><span class="w"></span>

<span class="w">    </span><span class="nt">intervals</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'6month'</span><span class="p p-Indicator">]</span><span class="w"></span>
</code></pre></div>
<p><code>feature_aggregations</code> is a <code>yaml</code> list<sup><a class="footref" href="#fn.10" id="fnr.10">10</a></sup> of <em>feature groups
construction specification</em> or just <em>feature group</em>. A <em>feature group</em>
is a way of grouping several features that share <code>intervals</code> and source data
(<code>from_obj</code>). <code>triage</code> requires the following configuration parameter for
every <em>feature group</em>:</p>
<ul>
<li><strong><code>prefix</code>:</strong> This will be used for name of the <em>feature</em> created</li>
<li><strong><code>from_obj</code>:</strong> Represents a <code>TABLE</code> object in <code>PostgreSQL</code>. You can pass a <em>table</em> like in the example above (<code>semantic.events</code>) or a <code>SQL</code> query that returns a table. We will see an example of this later. <code>triage</code> will use it like the <code>FROM</code> clause in the <code>SQL</code> query.</li>
<li><strong><code>knowlege_date_column</code>:</strong> Column that indicates the date of the event.</li>
<li><strong><code>intervals</code>:</strong> A <code>yaml</code> list. <code>triage</code> will create one feature per interval listed.</li>
</ul>
<p>The last section to discuss is <code>imputation</code>. Imputation is very
important step in the modeling, and you should carefully think about
how you will impute the missing values in the feature. After deciding
the best way of impute <em>each</em> feature, you should avoid leakage (For
example, imagine that you want to impute with the <strong>mean</strong> one
feature. You could have leakage if you take all the values of the
column, including ones of the future to calculate the imputation). We
will return to this later in this tutorial.</p>
<p><code>Collate</code> is in charge of creating the <code>SQL</code> agregation
queries. Another way of thinking about it is that <code>collate</code>
encapsulates the <code>FROM</code> part of the query (<code>from_obj</code>) as well as the
<code>GROUP BY</code> aggregation at the <code>entity_id</code> level.</p>
<p><code>triage</code> (<code>collate</code>) supports two types of objects to be aggregated:
<code>aggregates</code> and <code>categoricals</code> (more on this one later)<sup><a class="footref" href="#fn.11" id="fnr.11">11</a></sup>. The
<code>aggregates</code> subsection represents a <code>yaml</code> list of <em>features</em> to be
created. Each element on this represents a column (<code>quantity</code>, in the
example, the whole row <code>*</code>) and an alias (<code>total</code>), defines the
<code>imputation</code> strategy for <code>NULLs</code>, and the <code>metric</code> refers to the
<code>aggregation function</code> to be applied to the <code>quantity</code> (<code>count</code>).</p>
<p><code>triage</code> will generate the following (or a very similar one), one per each combination of <code>interval</code> Ã— <code>quantity</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"></span>
<span class="w">  </span><span class="n">metric</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">alias</span><span class="w"></span>
<span class="k">from</span><span class="w"></span>
<span class="w">  </span><span class="n">from_obj</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">  </span><span class="n">as_of_date</span><span class="w"> </span><span class="o">&lt;@</span><span class="w"> </span><span class="p">(</span><span class="n">as_of_date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">interval</span><span class="p">,</span><span class="w"> </span><span class="n">as_of_date</span><span class="p">)</span><span class="w"></span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"></span>
<span class="w">  </span><span class="k">grouping</span><span class="w"> </span><span class="k">sets</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>With the previous configuration <code>triage</code> will generate <strong>1</strong> feature with the following name:<sup><a class="footref" href="#fn.12" id="fnr.12">12</a></sup></p>
<ul>
<li><code>inspections_entity_id_6month_total_count</code></li>
</ul>
<p>All the features of that <em>feature group</em> (in this case only 1) will be stored in the table.</p>
<ul>
<li><code>features.inspections_aggregation_imputed</code></li>
</ul>
<p>In general the names of the generated tables are constructed as follows:</p>
<div class="highlight"><pre><span></span><code>schema.prefix_group_aggregation_imputed
</code></pre></div>
<p><strong>NOTE</strong>: the outputs are stored in the <code>features</code> schema.</p>
<p>Inside each of those new tables, the feature name will follow this pattern:</p>
<div class="highlight"><pre><span></span><code>prefix_group_interval_alias_aggregation_operation
</code></pre></div>
<p>If we complicate a little the above configuration adding new intervals:</p>
<div class="highlight"><pre><span></span><code><span class="nt">feature_aggregations</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"></span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">'inspections'</span><span class="w"></span>
<span class="w">    </span><span class="nt">from_obj</span><span class="p">:</span><span class="w"> </span><span class="s">'semantic.events'</span><span class="w"></span>
<span class="w">    </span><span class="nt">knowledge_date_column</span><span class="p">:</span><span class="w"> </span><span class="s">'date'</span><span class="w"></span>

<span class="w">    </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="c1"># number of inspections</span><span class="w"></span>
<span class="w">        </span><span class="nt">quantity</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">total</span><span class="p">:</span><span class="w"> </span><span class="s">"*"</span><span class="w"></span>

<span class="w">        </span><span class="nt">imputation</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">count</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">'zero_noflag'</span><span class="w"></span>

<span class="w">        </span><span class="nt">metrics</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'count'</span><span class="p p-Indicator">]</span><span class="w"></span>

<span class="w">    </span><span class="nt">intervals</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'3month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'6month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'1y'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'all'</span><span class="p p-Indicator">]</span><span class="w"></span>
</code></pre></div>
<p>You will end with 5 new <em>features</em>, one for each interval (5) Ã— the only aggregate definition we have. Note the weird <code>all</code> in the <code>intervals</code> definition. <code>all</code> is the time interval between the <code>feature_start_time</code> and the <code>as_of_date</code>.</p>
<p><code>triage</code> also supports <code>categorical</code> objects. The following code adds a <em>feature</em> for the <code>risk</code> flag.</p>
<div class="highlight"><pre><span></span><code><span class="nt">feature_aggregations</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"></span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">'inspections'</span><span class="w"></span>
<span class="w">    </span><span class="nt">from_obj</span><span class="p">:</span><span class="w"> </span><span class="s">'semantic.events'</span><span class="w"></span>
<span class="w">    </span><span class="nt">knowledge_date_column</span><span class="p">:</span><span class="w"> </span><span class="s">'date'</span><span class="w"></span>

<span class="w">    </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="c1"># number of inspections</span><span class="w"></span>
<span class="w">        </span><span class="nt">quantity</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">total</span><span class="p">:</span><span class="w"> </span><span class="s">"*"</span><span class="w"></span>

<span class="w">        </span><span class="nt">imputation</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">count</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">'zero_noflag'</span><span class="w"></span>

<span class="w">        </span><span class="nt">metrics</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'count'</span><span class="p p-Indicator">]</span><span class="w"></span>

<span class="w">    </span><span class="nt">intervals</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'3month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'6month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'1y'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'all'</span><span class="p p-Indicator">]</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"></span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">'risks'</span><span class="w"></span>
<span class="w">    </span><span class="nt">from_obj</span><span class="p">:</span><span class="w"> </span><span class="s">'semantic.events'</span><span class="w"></span>
<span class="w">    </span><span class="nt">knowledge_date_column</span><span class="p">:</span><span class="w"> </span><span class="s">'date'</span><span class="w"></span>

<span class="w">    </span><span class="nt">categoricals_imputation</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">sum</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">'zero'</span><span class="w"></span>

<span class="w">    </span><span class="nt">categoricals</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"></span>
<span class="w">        </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="s">'risk'</span><span class="w"></span>
<span class="w">        </span><span class="nt">choice_query</span><span class="p">:</span><span class="w"> </span><span class="s">'select</span><span class="nv"> </span><span class="s">distinct</span><span class="nv"> </span><span class="s">risk</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">semantic.events'</span><span class="w"></span>
<span class="w">          </span><span class="nt">metrics</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'sum'</span><span class="w"></span>

<span class="w">    </span><span class="nt">intervals</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'3month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'6month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'1y'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'all'</span><span class="p p-Indicator">]</span><span class="w"></span>
</code></pre></div>
<p>There are several changes. First, the imputation strategy in this new
<em>feature group</em> is for every categorical features in that feature
group (in that example only one). The next change is the type: instead
of <code>aggregates</code>, it's <code>categoricals</code>. <code>categoricals</code> define a <code>yaml</code>
list too. Each <code>categorical</code> feature needs to define a <code>column</code> to be
aggregated and the query to get all the distinct values.</p>
<p>With this configuration, <code>triage</code> will generate two tables, one per
<em>feature group</em>. The new table will be
<code>features.risks_aggregation_imputed</code>. This table will have more
columns: <code>intervals</code> (5) Ã— <code>metric</code> (1)
Ã— <em>features</em> (1) Ã— <em>number of choices returned by the
query</em>.</p>
<p>The query:</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">risk</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">semantic</span><span class="p">.</span><span class="n">events</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<table>
<thead>
<tr>
<th>risk</th>
</tr>
</thead>
<tbody>
<tr>
<td>Â¤</td>
</tr>
<tr>
<td>medium</td>
</tr>
<tr>
<td>high</td>
</tr>
<tr>
<td>low</td>
</tr>
</tbody>
</table>
<p>returns 4 possible values (including <code>NULL</code>). When dealing with
categorical aggregations you need to be careful. Could be the case
that in some period of time, in your data, you don't have all the
possible values of the categorical variable. This could cause problems
down the road. Triage allows you to specify the possible values
(<em>choices</em>) of the variable. Instead of using <code>choice_query</code>, you
could use <code>choices</code> as follows:</p>
<div class="highlight"><pre><span></span><code><span class="nt">feature_aggregations</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"></span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">'inspections'</span><span class="w"></span>
<span class="w">    </span><span class="nt">from_obj</span><span class="p">:</span><span class="w"> </span><span class="s">'semantic.events'</span><span class="w"></span>
<span class="w">    </span><span class="nt">knowledge_date_column</span><span class="p">:</span><span class="w"> </span><span class="s">'date'</span><span class="w"></span>

<span class="w">    </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="c1"># number of inspections</span><span class="w"></span>
<span class="w">        </span><span class="nt">quantity</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">total</span><span class="p">:</span><span class="w"> </span><span class="s">"*"</span><span class="w"></span>

<span class="w">        </span><span class="nt">imputation</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">count</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">'mean'</span><span class="w"></span>

<span class="w">        </span><span class="nt">metrics</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'count'</span><span class="p p-Indicator">]</span><span class="w"></span>

<span class="w">    </span><span class="nt">intervals</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'3month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'6month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'1y'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'all'</span><span class="p p-Indicator">]</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"></span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">'risks'</span><span class="w"></span>
<span class="w">    </span><span class="nt">from_obj</span><span class="p">:</span><span class="w"> </span><span class="s">'semantic.events'</span><span class="w"></span>
<span class="w">    </span><span class="nt">knowledge_date_column</span><span class="p">:</span><span class="w"> </span><span class="s">'date'</span><span class="w"></span>

<span class="w">    </span><span class="nt">categoricals_imputation</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">sum</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">'zero'</span><span class="w"></span>

<span class="w">    </span><span class="nt">categoricals</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"></span>
<span class="w">        </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="s">'risk'</span><span class="w"></span>
<span class="w">        </span><span class="nt">choices</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'low'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'medium'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'high'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">          </span><span class="nt">metrics</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'sum'</span><span class="w"></span>

<span class="w">    </span><span class="nt">intervals</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'1month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'3month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'6month'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'1y'</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">'all'</span><span class="p p-Indicator">]</span><span class="w"></span>
</code></pre></div>
<p>In both cases <code>triage</code> will generate <code>20</code> new features, as expected.</p>
<p>The features generated from categorical objects will have the following pattern:</p>
<div class="highlight"><pre><span></span><code>prefix_group_interval_column_choice_aggregation_operation
</code></pre></div>
<p>So, <code>risks_entity_id_1month_risk_medium_sum</code> will be among our new features in the last example.</p>
<p><code>Triage</code> will also add several imputation <em>flag</em> (binary) columns per
feature. Those columns convey information about if that particular
value was <em>imputed</em> or <em>not</em>. The section below describes how imputation
can be specified in <code>triage</code> in more detail.</p>
<h3 id="imputation">Imputation<a class="headerlink" href="#imputation" title="Permanent link">#</a></h3>
<p><code>Triage</code> currently supports the following imputation strategies:</p>
<ul>
<li>
<p><code>mean</code>: The mean value of the feature.</p>
</li>
<li>
<p><code>constant</code>: Fill with a constant (you need to provide the constant value).</p>
</li>
<li>
<p><code>zero</code>: Same that the previous one, but the constant is zero.</p>
</li>
<li>
<p><code>zero_noflag</code>: Sometimes, the absence (i.e. a NULL)
    doesn't mean that the value is missing, that actually means that
    the event didn't happen to that entity. For example a <code>NULL</code> in
    the <code>inspections_entity_id_1month_total_count</code> column in
    <code>features.inspections_aggreagtion_imputed</code> doesn't mean that the
    value is missing, it means that <em>zero</em> inspections happen to that
    facility in the last month. Henceforth, the <em>flag</em> column is not
    needed.</p>
</li>
</ul>
<p>Only for aggregates:</p>
<ul>
<li><code>binary_mode</code>: Takes the mode of a binary feature</li>
</ul>
<p>Only for categoricals:</p>
<ul>
<li><code>null_category</code>: Just flag null values with the null category column</li>
</ul>
<p>and finally, if you are sure that is not possible to have <em>NULLS:</em></p>
<ul>
<li><code>error</code>: Raise an exception if ant null values are encountered.</li>
</ul>
<h3 id="feature-groups-strategies">Feature groups strategies<a class="headerlink" href="#feature-groups-strategies" title="Permanent link">#</a></h3>
<p>Another interesting thing that <code>triage</code> controls is how many feature groups are used in the machine learning grid. This would help you to understand the effect of using different groups in the final performance of the models.</p>
<p>In <code>simple_test_skeleton.yaml</code> you will find the following blocks:</p>
<div class="highlight"><pre><span></span><code><span class="nt">feature_group_definition</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">prefix</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'results'</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'risks'</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'inspections'</span><span class="w"></span>

<span class="nt">feature_group_strategies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'all'</span><span class="p p-Indicator">]</span><span class="w"></span>
</code></pre></div>
<p>This configuration adds to the <em>number</em> of model groups to be created.</p>
<p>The possible feature group strategies are:</p>
<ul>
<li><strong><code>all</code>:</strong> All the features groups are used.</li>
<li><strong><code>leave-one-out</code>:</strong> All the combinations of: "All the feature groups except one are used".</li>
<li><strong><code>leave-one-in</code>:</strong> All the combinations of "One feature group except the rest is used"</li>
<li><strong><code>all-combinations</code>:</strong> All the combinations of <em>feature groups</em></li>
</ul>
<p>In order to clarify these concepts, let's use <code>simple_test_skeleton.yaml</code> configuration file. In it there are three feature groups: <code>inspections</code>, <code>results</code>, <code>risks</code>.</p>
<p>Using <code>all</code> will create just one set containg all the features of the three feature groups:</p>
<ul>
<li><code>{inspections, results, risks}</code></li>
</ul>
<p>If you modify <code>feature_group_strategies</code> to <code>['leave-one-out']</code>: the following sets will be created:</p>
<ul>
<li><code>{inspections, results}, {inspections, risks}, {results, risks}</code></li>
</ul>
<p>Using the <code>leave-one-in</code> strategy:</p>
<ul>
<li><code>{inspections}, {results}, {risks}</code></li>
</ul>
<p>Finally choosing <code>all-combinations</code>:</p>
<ul>
<li><code>{inspections}, {results}, {risks}, {inspections, results}</code>, <code>{inspections, risks}, {results, risks}, {inspections, results, risks}</code></li>
</ul>
<h3 id="controlling-the-size-of-the-tables">Controlling the size of the tables<a class="headerlink" href="#controlling-the-size-of-the-tables" title="Permanent link">#</a></h3>
<blockquote>
<p>This section is a little technical, you can skip it if you fell like it.</p>
</blockquote>
<p>By default, <code>triage</code> will use the biggest column type for the features
table (<code>integer</code>, <code>numeric</code>, etc). This could lead to humongous
tables, with sizes several hundred of gigabytes. <code>Triage</code> took that
decision, because it doesn't know anything about the possible values
of your data (e.g. Is it possible to have millions of inspections in
one month? or just a few dozens?).</p>
<p>If you are facing this difficulty, you can force <code>triage</code> to <em>cast</em>
the column in the <em>features</em> table. Just add <code>coltype</code> to the
<code>aggregate/categorical</code> block:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="nt">aggregates</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"></span>
<span class="w">    </span><span class="nt">quantity</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">total</span><span class="p">:</span><span class="w"> </span><span class="s">"*"</span><span class="w"></span>
<span class="w">    </span><span class="nt">metrics</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">'count'</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">coltype</span><span class="p">:</span><span class="w"> </span><span class="s">'smallint'</span><span class="w"></span>
</code></pre></div>
<p><a id="org91afffc"></a></p>
<h2 id="the-grid">The Grid<a class="headerlink" href="#the-grid" title="Permanent link">#</a></h2>
<p>Before applying Machine Learning to your dataset you don't know which combination of algorithm and hyperparameters will be the best given a specific matrix.</p>
<p><code>Triage</code> approaches this problem exploring a algorithm +
hyperparameters + feature groups grid. At this time, this exploration
is a exhaustive one, i.e. it covers the complete grid, so you would
get (number of algorithms) <span><span class="MathJax_Preview">\times</span><script type="math/tex">\times</script></span> (number of hyperparameters)
<span><span class="MathJax_Preview">\times</span><script type="math/tex">\times</script></span> (number of feature group strategies) models groups. The
number of models trained is (number of model groups) <span><span class="MathJax_Preview">\times</span><script type="math/tex">\times</script></span>
(number of time splits).</p>
<p>In our simple experiment the grid is very simple:</p>
<div class="highlight"><pre><span></span><code><span class="nt">grid_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="s">'sklearn.dummy.DummyClassifier'</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">most_frequent</span><span class="p p-Indicator">]</span><span class="w"></span>
</code></pre></div>
<p>Just one algorithm and one hyperparameter (also we have only one
feature group strategy: <code>all</code>), and two time splits. So we will get 2
models, 1 model group.</p>
<p>Keep in mind that the grid is providing more than way to select a
model. You can use the tables generated by the grid (see section
<a href="../ml_governance/">Machine Learning Governance</a> ) and <em>analyze</em> and
<em>understand</em> your data. In other words, analyzing the results
(evaluations, predictions, hyperparameter space, etc.) is like
applying <strong>Data mining</strong> concepts to your data using Machine
learning. We will return to this when we apply post modeling to our
models.</p>
<h2 id="audition">Audition<a class="headerlink" href="#audition" title="Permanent link">#</a></h2>
<p><strong>Audition</strong> is a tool for helping you select a subset of trained
classifiers from a triage experiment. Often, production-scale
experiments will come up with thousands of trained models, and sifting
through all of those results can be time-consuming even after
calculating the usual basic metrics like precision and recall.</p>
<p>You will be facing questions as:</p>
<ul>
<li>Which metrics matter most?</li>
<li>Should you prioritize the best metric value over time or treat recent data as most important?</li>
<li>Is low metric variance important?</li>
</ul>
<p>The answers to questions like these may not be obvious. <strong>Audition</strong>
introduces a structured, semi-automated way of filtering models based
on what you consider important.</p>
<h2 id="post-modeling">Post-modeling<a class="headerlink" href="#post-modeling" title="Permanent link">#</a></h2>
<p>As the name indicates, <strong>postmodeling</strong> occurs <strong>after</strong> you have
modeled (potentially) thousands of models (different hyperparameters,
different time windows, different algorithms, etc), and using
<code>audition</code> you <em>pre</em> selected a small number of models.</p>
<p>Now, with the <strong>postmodeling</strong> tools you will be able to select your final model for <em>production</em> use.</p>
<p>Triage's postmodeling capabilities include:</p>
<ul>
<li>Show the score distribution</li>
<li>Compare the list generated by a set of models</li>
<li>Compare the feature importance between a set of models</li>
<li>Diplay the probability calibration curves</li>
<li>Analyze the errors using a decision tree trained on the errors of the model.</li>
<li>Cross-tab analysis</li>
<li>Bias analysis</li>
</ul>
<p>If you want to see <strong>Audition</strong> and <strong>Postmodeling</strong> in action, we
will use them after <strong>Inspections</strong> and <strong>EIS modeling</strong>.</p>
<h2 id="final-cleaning">Final cleaning<a class="headerlink" href="#final-cleaning" title="Permanent link">#</a></h2>
<p>In the next section we will start modeling, so it is a good idea to
clean the <code>{test, train}_results</code> schemas and have a fresh start:</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">nuke_triage</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<table>
<thead>
<tr>
<th>nuke<sub>triage</sub></th>
</tr>
</thead>
<tbody>
<tr>
<td>triage was send to the oblivion. Long live to triage!</td>
</tr>
</tbody>
</table>
<p><code>triage</code> also creates a lot of files (we will see why in the next section). Let's remove them too.</p>
<div class="highlight"><pre><span></span><code>rm -r /triage/matrices/*
</code></pre></div>
<div class="highlight"><pre><span></span><code>rm -r /triage/trained_models/*
</code></pre></div>
<h2 id="where-to-go-from-here">Where to go from here...<a class="headerlink" href="#where-to-go-from-here" title="Permanent link">#</a></h2>
<p>If you haven't done so already, our <a href="https://dssg.github.io/triage/dirtyduck/">dirty duck tutorial</a> is a good way to geet up and running with some sample data.</p>
<p>If you're ready to get started with your own data, check out <a href="https://dssg.github.io/triage/triage_project_workflow/">the suggested project workflow</a> for some tips about how to iterate and tune the pipeline for your project.</p>
<h2 id="footnotes">Footnotes<a class="headerlink" href="#footnotes" title="Permanent link">#</a></h2>
<p><sup><a class="footnum" href="#fnr.1" id="fn.1">1</a></sup> <em>Would be my restaurant inspected in the following month?</em> in the case of an <strong>early warning</strong> case.</p>
<p><sup><a class="footnum" href="#fnr.2" id="fn.2">2</a></sup> It's a little more complicated than that as we will see.</p>
<p><sup><a class="footnum" href="#fnr.3" id="fn.3">3</a></sup> All events produce some <em>outcome</em>. In theory <strong>every</strong> event of interest in stored in a database. These events are <em>immutable</em>: you can't (shouldn't) change them (they already happen).</p>
<p><sup><a class="footnum" href="#fnr.4" id="fn.4">4</a></sup> We could consider different states, for example: we can use the column <code>risk</code> as an state. Another possibility is define a new state called <code>failed</code> that indicates if the facility failed in the last time it was inspected. One more: you could create cohorts based on the <code>facility_type.</code></p>
<p><sup><a class="footnum" href="#fnr.5" id="fn.5">5</a></sup> The city in this toy example has very low resources.</p>
<p><sup><a class="footnum" href="#fnr.6" id="fn.6">6</a></sup> See for example: <a href="https://robjhyndman.com/hyndsight/tscv/">https://robjhyndman.com/hyndsight/tscv/</a></p>
<p><sup><a class="footnum" href="#fnr.7" id="fn.7">7</a></sup> I know, I know. And in order to cover all the cases, we are still missing one or two parameters, but we are working on it.</p>
<p><sup><a class="footnum" href="#fnr.8" id="fn.8">8</a></sup> Obscure reference to the "<a href="https://www.imdb.com/title/tt0417299/">Avatar: The Last Airbender</a>" cartoon series. I'm sorry.</p>
<p><sup><a class="footnum" href="#fnr.9" id="fn.9">9</a></sup> <code>collate</code> is to <em>feature generation</em> what <code>timechop</code> is to <em>date temporal splitting</em></p>
<p><sup><a class="footnum" href="#fnr.10" id="fn.10">10</a></sup> <code>triage</code> uses <strong>a lot</strong> of <code>yaml</code>, <a href="https://github.com/Animosity/CraftIRC/wiki/Complete-idiot%27s-introduction-to-yaml">this guide</a> could be handy</p>
<p><sup><a class="footnum" href="#fnr.11" id="fn.11">11</a></sup> Note that the name <code>categoricals</code> is confusing here: The original variable (i.e. a column) is categorical, the aggregate of that column is not. The same with the <code>aggregates</code>: The original column could be a categorical or a numeric (to be fare most of the time is a numeric column, but see the example: <em>we are counting</em>), and then <code>triage</code> applies an aggregate that will be numeric. That is how triage named things, and yes, I know is confusing.</p>
<p><sup><a class="footnum" href="#fnr.12" id="fn.12">12</a></sup> <code>triage</code> will generate also a new binary column that indicates if the value of the feature was imputed (<code>1</code>) or not (<code>0</code>): <code>inspections_entity_id_6month_total_count_imp</code>.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a class="md-footer__link md-footer__link--prev" href="../inspections/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Resource prioritization
            </div>
</div>
</a>
<a class="md-footer__link md-footer__link--next" href="../infrastructure/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Infrastructure
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/dssg/triage" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://twitter.com/datascifellows" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://linkedin.com/company/center-for-data-science-and-public-policy-university-of-chicago" rel="noopener" target="_blank" title="linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.a1c7c35e.min.js"></script>
<script src="../../js/mermaid.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>